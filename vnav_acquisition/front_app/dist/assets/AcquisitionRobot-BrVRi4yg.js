import{P as c,t as pe,r as t,v as _,j as e,S as u,p as W,T as F,M as k,l as O,x as N,z as L,w as G,y as J}from"./index-XujsHqft.js";import{A as fe,d as me,a as je,W as be,R as we,V as Se,L as ye}from"./VideoAudioSelect-Dp8L_DPw.js";import{d as ve,I as Y}from"./DeleteOutline-C8hWQd_u.js";import{T as $}from"./TextField-BGl605yR.js";Q.propTypes={username:c.string.isRequired,material:c.string,speed:c.string,isCamera:c.bool.isRequired,measurementCounter:c.number.isRequired,setMeasurementCounter:c.func.isRequired,isRecordingStarted:c.func.isRequired,selectedVideoDevices:c.array.isRequired,videoDevices:c.array.isRequired,audioFiles:c.array.isRequired,setAudioFiles:c.func.isRequired,setRecordingStatus:c.string.isRequired,localDir:c.string.isRequired};function Q({username:g,material:n,speed:d,measurementCounter:f,setMeasurementCounter:m,selectedVideoDevices:b,videoDevices:w,setAudioFiles:S,setRecordingStatus:y,localDir:D}){const l=pe(),v=t.useRef(null),i=t.useRef([]),[M,P]=t.useState([]),[h,x]=t.useState([]),[H,U]=t.useState([]),[C,a]=t.useState(!1),[I,se]=t.useState(!1),[z,T]=t.useState(!1),[te,j]=t.useState(""),X=t.useCallback((s,{data:r},o)=>{r.size>0&&x(R=>[...R,{recorder:s,data:r,cameraIndex:o}])},[x]),ae=async()=>{try{const r=(await Promise.all(H.map(async o=>{const R=w[o];if(!R)return console.log("Video device not found. Camera Index: "+o),null;const q=await navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:R.deviceId}},audio:!0}),p=new we(q,{mimeType:"video/webm"});return p.startRecording(),p.ondataavailable=B=>X(p,{data:B},o),i.current.push({recorder:p,stream:q}),{recorder:p,stream:q}}))).filter(Boolean);i.current=r}catch(s){console.error("Error starting multiple recordings:",s),j(`Error starting recordings: ${s.message}`)}},re=()=>{i.current&&i.current.length>0?(i.current.forEach(({recorder:s,stream:r})=>{s.stopRecording(()=>{const o=s.getBlob();X(s,{data:o})}),r.getTracks().forEach(o=>o.stop())}),i.current=[]):console.warn("No recordings to stop or recorders were not initialized.")};t.useEffect(()=>{I?ae():re()},[I]);const Z=async()=>{if(h&&h.length>0){T(!1);let s=0;const r=h.map(async({data:o,cameraIndex:R})=>{const q=new Blob([o],{type:"video/webm"}),p=new Date,B=p.getFullYear(),oe=String(p.getMonth()+1).padStart(2,"0"),ne=String(p.getDate()).padStart(2,"0"),ie=String(p.getHours()).padStart(2,"0"),de=String(p.getMinutes()).padStart(2,"0"),le=String(p.getSeconds()).padStart(2,"0"),ce=`${B}${oe}${ne}_${ie}${de}${le}`,ue=`${g}_${n}_${d}_camera${R||s}_${ce}.webm`;R===void 0&&s++;const K=new FileReader;return new Promise((ge,he)=>{K.onloadend=async()=>{const xe=K.result.split(",")[1];try{const E=await _.post("/save_video",{filename:ue,local_dir:D,data:xe});ge(E.data)}catch(E){console.error("Error uploading video:",E),he(E)}},K.readAsDataURL(q)})});try{const o=await Promise.all(r);console.log("Uploaded videos:",o),j(l.formatMessage({id:"recordingUploaded"})+o[0].filename)}catch(o){console.error("Error during upload:",o)}}else console.log("Error with recorded chunks")},A=t.useCallback(async()=>{a(!0);try{if(I){const s=await _.get("/stop_dobot"),r=s.data.map(o=>o.filename);j(l.formatMessage({id:"recordedSuccesfully"})+r.join(", ")),m(f+1),T(!0),S(s.data),y("stop")}else j(l.formatMessage({id:"connectingToRaspberry"})),await _.post("/start_dobot",{username:g,material:n,speed:d}),j(l.formatMessage({id:"recordingStarted"})),z&&await Z(),T(!1),U(b.map(s=>w.findIndex(r=>r.label===s)).filter(s=>s!==-1)),x([]),y("start");se(s=>!s)}catch(s){j(l.formatMessage({id:"recordingConnectFailed"})+s)}finally{a(!1)}},[I,f,g,n,d,m,S]),V=t.useCallback(async()=>{a(!0);try{const s=await _.get("/delete_last");j(l.formatMessage({id:"recordingDeleteSuccess"})+s.data),m(f-1>=0?f-1:0),T(!1),x([]),y("delete")}catch(s){j(l.formatMessage({id:"recordingDeleteFailed"})+s)}finally{a(!1)}},[f,m]);return t.useEffect(()=>{const s=r=>{C||d==null||n==null||d==null||n==null||(r.ctrlKey&&r.shiftKey&&r.key==="R"?A():r.ctrlKey&&r.shiftKey&&r.key==="D"&&V())};return window.addEventListener("keydown",s),()=>{window.removeEventListener("keydown",s)}},[A,V]),e.jsxs(u,{spacing:2,children:[e.jsx(fe,{}),e.jsxs(u,{direction:"row",spacing:2,children:[e.jsx(W,{onClick:A,variant:"contained",startIcon:I?e.jsx(me,{sx:{color:"red"}}):null,disabled:C||d==null||n==null||d==null||n==null,children:I?l.formatMessage({id:"stopRecording"}):l.formatMessage({id:"startRecording"})}),z&&e.jsx(W,{onClick:V,variant:"contained",disabled:C||d==null||n==null||d==null||n==null,startIcon:e.jsx(ve,{}),children:l.formatMessage({id:"deleteRecording"})}),z&&h&&h.length>0&&e.jsx(W,{onClick:Z,variant:"contained",ref:M,disabled:C||d==null||n==null||d==null||n==null,startIcon:e.jsx(je,{}),children:l.formatMessage({id:"downloadRecording"})})]}),e.jsx(F,{children:te}),e.jsx(be,{selectedVideoDevices:b,videoDevices:w,webcamRef:v})]})}const ee=({config:g})=>{const[n,d]=t.useState("Only Up and Down"),[f,m]=t.useState({x:"350",y:"0",z:"70"}),[b,w]=t.useState({x:"350",y:"0",z:"70"}),[S,y]=t.useState({x:"350",y:"0",z:"20"}),[D,l]=t.useState("22"),v=(i,M,P)=>e.jsxs(u,{sx:{gap:1},children:[e.jsxs(F,{children:[P,":"]}),e.jsxs(u,{direction:"row",children:[e.jsx($,{label:"X",value:i.x,onChange:h=>M(x=>({...x,x:h.target.value}))}),e.jsx($,{label:"Y",value:i.y,onChange:h=>M(x=>({...x,y:h.target.value}))}),e.jsx($,{label:"Z",value:i.z,onChange:h=>M(x=>({...x,z:h.target.value}))})]})]});return e.jsxs(u,{sx:{border:"solid grey 2px",borderRadius:5,padding:3,gap:3},children:[e.jsx(F,{id:"dobotInterface",labelId:"dobotInterface",variant:"h7",children:e.jsx(k,{id:"dobotInterface"})}),e.jsxs(O,{fullWidth:!0,children:[e.jsx(Y,{children:"Position Type"}),e.jsxs(N,{value:n,onChange:i=>d(i.target.value),children:[e.jsx(L,{value:"Only Up and Down",children:"Only Up and Down"}),e.jsx(L,{value:"Up, Down, Forward",children:"Up, Down, Forward"})]})]}),e.jsxs(u,{sx:{gap:2},children:[v(f,m,"Up (P1)"),v(b,w,"Down (P2)"),n==="Up, Down, Forward"&&e.jsx(e.Fragment,{children:v(S,y,"Forward (P3)")})]}),e.jsx($,{label:"Number of Iterations",value:D,onChange:i=>l(i.target.value),fullWidth:!0})]})};ee.propTypes={config:c.object.isRequired};const Re=({config:g})=>{const[n,d]=t.useState([]),[f,m]=t.useState([]),[b,w]=t.useState(null),[S,y]=t.useState(null),[D,l]=t.useState(0),[v,i]=t.useState([]),[M,P]=t.useState("init"),h=sessionStorage.getItem("commentAcquisiton")||"",[x,H]=t.useState(h),U=a=>{w(a.target.value)},C=a=>{y(a.target.value)};return t.useEffect(()=>{sessionStorage.setItem("commentAcquisiton",x)},[x]),console.log("Acq Robot",g),e.jsx("div",{children:e.jsxs(u,{sx:{width:"100%",gap:5},direction:"row",children:[e.jsxs(u,{sx:{width:"100%",gap:5},direction:"row",children:[e.jsxs(u,{sx:{gap:3,width:"40%"},children:[e.jsxs(F,{id:"username",labelId:"usernameLabel",variant:"h6",children:[e.jsx(k,{id:"username"}),": ",g.username]}),e.jsxs(u,{sx:{width:"100%",gap:2},children:[e.jsx(Se,{selectedVideoDevices:n,setSelectedVideoDevices:d,videoDevices:f,setVideoDevices:m}),e.jsxs(u,{sx:{width:"100%",gap:2},children:[e.jsxs(O,{sx:G,children:[e.jsx(Y,{children:e.jsx(k,{id:"Material"})}),e.jsx(N,{sx:J,labelId:"materialSelect",label:"Material",id:"material",value:b,onChange:U,children:g.chosenMaterials.filter(a=>a!==0).map(a=>e.jsx(L,{value:a,children:a},a))})]}),e.jsxs(O,{sx:G,children:[e.jsx(Y,{children:e.jsx(k,{id:"speed"})}),e.jsx(N,{sx:J,labelId:"materialSelect",label:"Speed",id:"speed",value:S,onChange:C,children:g.chosenSpeeds.filter(a=>a!==0).map(a=>e.jsx(L,{value:a,children:a},a))})]})]})]}),e.jsx(u,{sx:{width:"100%"},children:e.jsx(ye,{config:g})}),e.jsxs(F,{children:[e.jsx(k,{id:"performedMeasurements"}),": ",D]})]}),e.jsx(u,{sx:{gap:3,width:"50%"},children:e.jsx(ee,{config:g})})]}),e.jsx(u,{sx:{width:"50%"},mt:1,spacing:2,children:e.jsx(Q,{username:g.username,material:b,speed:S,measurementCounter:D,setMeasurementCounter:l,selectedVideoDevices:n,videoDevices:f,audioFiles:v,setAudioFiles:i,setRecordingStatus:P,localDir:g.local_dir})})]})})};Re.propTypes={config:c.object.isRequired};export{Re as default};
