import{n as qe,o as ze,j as m,P as Y,r as _,C as Tt,B as kt,x as _e,M as Te,t as Lt,z as J,A as at,p as ye,T as Fe,D as Be,E as At,G as ot,k as He,H as $e,S as Ke,J as Je,K as Qe}from"./index-Vq_E5_2Y.js";import{L as jt,a as Dt,C as st,b as dt,d as Ut,I as Ye}from"./DeleteOutline-CNYV-Eyh.js";var Xe={},It=ze;Object.defineProperty(Xe,"__esModule",{value:!0});var ut=Xe.default=void 0,Bt=It(qe()),Ft=m;ut=Xe.default=(0,Bt.default)((0,Ft.jsx)("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check");var Ze={},Et=ze;Object.defineProperty(Ze,"__esModule",{value:!0});var ct=Ze.default=void 0,Ot=Et(qe()),Pt=m;ct=Ze.default=(0,Ot.default)((0,Pt.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-2h2zm0-4h-2V7h2z"}),"Error");function ft({config:V}){const[g,G]=_.useState(!1),[H,q]=_.useState(V.chosen_lab_checks),I=()=>{G(A=>!A)},C=()=>{G(!1)};_.useEffect(()=>{q(V.chosen_lab_checks)},[V]);const[D,U]=_.useState(()=>(V.chosen_lab_checks||[]).reduce((A,E)=>(A[E]=!1,A),{})),K=A=>E=>{U(f=>({...f,[A]:E.target.checked}))},B=H.length>0&&H.every(A=>D[A]),ae={backgroundColor:!B&&"secondary.main","&:hover":{backgroundColor:!B&&"secondary.main"},"&:active":{backgroundColor:!B&&"secondary.main"}};return m.jsx(Tt,{onClickAway:C,children:m.jsxs(kt,{sx:{position:"relative"},children:[m.jsxs(_e,{variant:"contained",onClick:I,sx:ae,children:[m.jsx(Te,{id:"beforeMessurmentsChecklist"}),B?m.jsx(ut,{}):m.jsx(ct,{})]}),g?m.jsx(Lt,{sx:{width:"100%",maxHeight:300,overflow:"auto",bgcolor:"background.paper",borderRadius:"0% 0% 2% 2%"},children:H.map(A=>m.jsx(jt,{disablePadding:!0,children:m.jsxs(Dt,{onClick:K(A),dense:!0,children:[m.jsx(st,{checked:!!D[A],onChange:K(A)}),A,m.jsx(dt,{})]})},A))}):null]})})}ft.propTypes={config:Y.shape({chosen_lab_checks:Y.arrayOf(Y.string)}).isRequired};var et={},_t=ze;Object.defineProperty(et,"__esModule",{value:!0});var lt=et.default=void 0,qt=_t(qe()),zt=m;lt=et.default=(0,qt.default)((0,zt.jsx)("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"}),"Download");var tt={},Wt=ze;Object.defineProperty(tt,"__esModule",{value:!0});var ht=tt.default=void 0,Nt=Wt(qe()),Vt=m;ht=tt.default=(0,Nt.default)((0,Vt.jsx)("path",{d:"M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5m0-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"}),"RadioButtonChecked");var pt={exports:{}};(function(V){/**
 * {@link https://github.com/muaz-khan/RecordRTC|RecordRTC} is a WebRTC JavaScript library for audio/video as well as screen activity recording. It supports Chrome, Firefox, Opera, Android, and Microsoft Edge. Platforms: Linux, Mac and Windows. 
 * @summary Record audio, video or screen inside the browser.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef RecordRTC
 * @class
 * @example
 * var recorder = RecordRTC(mediaStream or [arrayOfMediaStream], {
 *     type: 'video', // audio or video or gif or canvas
 *     recorderType: MediaStreamRecorder || CanvasRecorder || StereoAudioRecorder || Etc
 * });
 * recorder.startRecording();
 * @see For further information:
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - Single media-stream object, array of media-streams, html-canvas-element, etc.
 * @param {object} config - {type:"video", recorderType: MediaStreamRecorder, disableLogs: true, numberOfAudioChannels: 1, bufferSize: 0, sampleRate: 0, desiredSampRate: 16000, video: HTMLVideoElement, etc.}
 */function g(r,e){if(!r)throw"First parameter is required.";e=e||{type:"video"},e=new G(r,e);var t=this;function a(o){return e.disableLogs||console.log("RecordRTC version: ",t.version),o&&(e=new G(r,o)),e.disableLogs||console.log("started recording "+e.type+" stream."),h?(h.clearRecordedData(),h.record(),w("recording"),t.recordingDuration&&l(),t):(d(function(){t.recordingDuration&&l()}),t)}function d(o){o&&(e.initCallback=function(){o(),o=e.initCallback=null});var R=new H(r,e);h=new R(r,e),h.record(),w("recording"),e.disableLogs||console.log("Initialized recorderType:",h.constructor.name,"for output-type:",e.type)}function s(o){if(o=o||function(){},!h){y();return}if(t.state==="paused"){t.resumeRecording(),setTimeout(function(){s(o)},1);return}t.state!=="recording"&&!e.disableLogs&&console.warn('Recording state should be: "recording", however current state is: ',t.state),e.disableLogs||console.log("Stopped recording "+e.type+" stream."),e.type!=="gif"?h.stop(R):(h.stop(),R()),w("stopped");function R(j){if(!h){typeof o.call=="function"?o.call(t,""):o("");return}Object.keys(h).forEach(function(M){typeof h[M]!="function"&&(t[M]=h[M])});var n=h.blob;if(!n)if(j)h.blob=n=j;else throw"Recording failed.";if(n&&!e.disableLogs&&console.log(n.type,"->",F(n.size)),o){var u;try{u=B.createObjectURL(n)}catch{}typeof o.call=="function"?o.call(t,u):o(u)}e.autoWriteToDisk&&S(function(M){var L={};L[e.type+"Blob"]=M,le.Store(L)})}}function c(){if(!h){y();return}if(t.state!=="recording"){e.disableLogs||console.warn("Unable to pause the recording. Recording state: ",t.state);return}w("paused"),h.pause(),e.disableLogs||console.log("Paused recording.")}function i(){if(!h){y();return}if(t.state!=="paused"){e.disableLogs||console.warn("Unable to resume the recording. Recording state: ",t.state);return}w("recording"),h.resume(),e.disableLogs||console.log("Resumed recording.")}function p(o){postMessage(new FileReaderSync().readAsDataURL(o))}function S(o,R){if(!o)throw"Pass a callback function over getDataURL.";var j=R?R.blob:(h||{}).blob;if(!j){e.disableLogs||console.warn("Blob encoder did not finish its job yet."),setTimeout(function(){S(o,R)},1e3);return}if(typeof Worker<"u"&&!navigator.mozGetUserMedia){var n=M(p);n.onmessage=function(L){o(L.data)},n.postMessage(j)}else{var u=new FileReader;u.readAsDataURL(j),u.onload=function(L){o(L.target.result)}}function M(L){try{var W=B.createObjectURL(new Blob([L.toString(),"this.onmessage =  function (eee) {"+L.name+"(eee.data);}"],{type:"application/javascript"})),O=new Worker(W);return B.revokeObjectURL(W),O}catch{}}}function l(o){if(o=o||0,t.state==="paused"){setTimeout(function(){l(o)},1e3);return}if(t.state!=="stopped"){if(o>=t.recordingDuration){s(t.onRecordingStopped);return}o+=1e3,setTimeout(function(){l(o)},1e3)}}function w(o){t&&(t.state=o,typeof t.onStateChanged.call=="function"?t.onStateChanged.call(t,o):t.onStateChanged(o))}var v='It seems that recorder is destroyed or "startRecording" is not invoked for '+e.type+" recorder.";function y(){e.disableLogs!==!0&&console.warn(v)}var h,k={startRecording:a,stopRecording:s,pauseRecording:c,resumeRecording:i,initRecorder:d,setRecordingDuration:function(o,R){if(typeof o>"u")throw"recordingDuration is required.";if(typeof o!="number")throw"recordingDuration must be a number.";return t.recordingDuration=o,t.onRecordingStopped=R||function(){},{onRecordingStopped:function(j){t.onRecordingStopped=j}}},clearRecordedData:function(){if(!h){y();return}h.clearRecordedData(),e.disableLogs||console.log("Cleared old recorded data.")},getBlob:function(){if(!h){y();return}return h.blob},getDataURL:S,toURL:function(){if(!h){y();return}return B.createObjectURL(h.blob)},getInternalRecorder:function(){return h},save:function(o){if(!h){y();return}X(h.blob,o)},getFromDisk:function(o){if(!h){y();return}g.getFromDisk(e.type,o)},setAdvertisementArray:function(o){e.advertisement=[];for(var R=o.length,j=0;j<R;j++)e.advertisement.push({duration:j,image:o[j]})},blob:null,bufferSize:0,sampleRate:0,buffer:null,reset:function(){t.state==="recording"&&!e.disableLogs&&console.warn("Stop an active recorder."),h&&typeof h.clearRecordedData=="function"&&h.clearRecordedData(),h=null,w("inactive"),t.blob=null},onStateChanged:function(o){e.disableLogs||console.log("Recorder state changed:",o)},state:"inactive",getState:function(){return t.state},destroy:function(){var o=e.disableLogs;e={disableLogs:!0},t.reset(),w("destroyed"),k=t=null,N.AudioContextConstructor&&(N.AudioContextConstructor.close(),N.AudioContextConstructor=null),e.disableLogs=o,e.disableLogs||console.log("RecordRTC is destroyed.")},version:"5.6.2"};if(!this)return t=k,k;for(var P in k)this[P]=k[P];return t=this,k}g.version="5.6.2",V.exports=g,g.getFromDisk=function(r,e){if(!e)throw"callback is mandatory.";console.log("Getting recorded "+(r==="all"?"blobs":r+" blob ")+" from disk!"),le.Fetch(function(t,a){r!=="all"&&a===r+"Blob"&&e&&e(t),r==="all"&&e&&e(t,a.replace("Blob",""))})},g.writeToDisk=function(r){console.log("Writing recorded blob(s) to disk!"),r=r||{},r.audio&&r.video&&r.gif?r.audio.getDataURL(function(e){r.video.getDataURL(function(t){r.gif.getDataURL(function(a){le.Store({audioBlob:e,videoBlob:t,gifBlob:a})})})}):r.audio&&r.video?r.audio.getDataURL(function(e){r.video.getDataURL(function(t){le.Store({audioBlob:e,videoBlob:t})})}):r.audio&&r.gif?r.audio.getDataURL(function(e){r.gif.getDataURL(function(t){le.Store({audioBlob:e,gifBlob:t})})}):r.video&&r.gif?r.video.getDataURL(function(e){r.gif.getDataURL(function(t){le.Store({videoBlob:e,gifBlob:t})})}):r.audio?r.audio.getDataURL(function(e){le.Store({audioBlob:e})}):r.video?r.video.getDataURL(function(e){le.Store({videoBlob:e})}):r.gif&&r.gif.getDataURL(function(e){le.Store({gifBlob:e})})};/**
 * {@link RecordRTCConfiguration} is an inner/private helper for {@link RecordRTC}.
 * @summary It configures the 2nd parameter passed over {@link RecordRTC} and returns a valid "config" object.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef RecordRTCConfiguration
 * @class
 * @example
 * var options = RecordRTCConfiguration(mediaStream, options);
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {type:"video", disableLogs: true, numberOfAudioChannels: 1, bufferSize: 0, sampleRate: 0, video: HTMLVideoElement, getNativeBlob:true, etc.}
 */function G(r,e){return!e.recorderType&&!e.type&&(e.audio&&e.video?e.type="video":e.audio&&!e.video&&(e.type="audio")),e.recorderType&&!e.type&&(e.recorderType===Ae||e.recorderType===Re||typeof Q<"u"&&e.recorderType===Q?e.type="video":e.recorderType===ke?e.type="gif":e.recorderType===ce?e.type="audio":e.recorderType===se&&(x(r,"audio").length&&x(r,"video").length||!x(r,"audio").length&&x(r,"video").length?e.type="video":x(r,"audio").length&&!x(r,"video").length&&(e.type="audio"))),typeof se<"u"&&typeof MediaRecorder<"u"&&"requestData"in MediaRecorder.prototype&&(e.mimeType||(e.mimeType="video/webm"),e.type||(e.type=e.mimeType.split("/")[0]),e.bitsPerSecond),e.type||(e.mimeType&&(e.type=e.mimeType.split("/")[0]),e.type||(e.type="audio")),e}/**
 * {@link GetRecorderType} is an inner/private helper for {@link RecordRTC}.
 * @summary It returns best recorder-type available for your browser.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef GetRecorderType
 * @class
 * @example
 * var RecorderType = GetRecorderType(options);
 * var recorder = new RecorderType(options);
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {type:"video", disableLogs: true, numberOfAudioChannels: 1, bufferSize: 0, sampleRate: 0, video: HTMLVideoElement, etc.}
 */function H(r,e){var t;return(f||ae||A)&&(t=ce),typeof MediaRecorder<"u"&&"requestData"in MediaRecorder.prototype&&!f&&(t=se),e.type==="video"&&(f||A)&&(t=Ae,typeof Q<"u"&&typeof ReadableStream<"u"&&(t=Q)),e.type==="gif"&&(t=ke),e.type==="canvas"&&(t=Re),re()&&t!==Re&&t!==ke&&typeof MediaRecorder<"u"&&"requestData"in MediaRecorder.prototype&&(x(r,"video").length||x(r,"audio").length)&&(e.type==="audio"?typeof MediaRecorder.isTypeSupported=="function"&&MediaRecorder.isTypeSupported("audio/webm")&&(t=se):typeof MediaRecorder.isTypeSupported=="function"&&MediaRecorder.isTypeSupported("video/webm")&&(t=se)),r instanceof Array&&r.length&&(t=z),e.recorderType&&(t=e.recorderType),!e.disableLogs&&t&&t.name&&console.log("Using recorderType:",t.name||t.constructor.name),!t&&b&&(t=se),t}/**
 * MRecordRTC runs on top of {@link RecordRTC} to bring multiple recordings in a single place, by providing simple API.
 * @summary MRecordRTC stands for "Multiple-RecordRTC".
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef MRecordRTC
 * @class
 * @example
 * var recorder = new MRecordRTC();
 * recorder.addStream(MediaStream);
 * recorder.mediaType = {
 *     audio: true, // or StereoAudioRecorder or MediaStreamRecorder
 *     video: true, // or WhammyRecorder or MediaStreamRecorder or WebAssemblyRecorder or CanvasRecorder
 *     gif: true    // or GifRecorder
 * };
 * // mimeType is optional and should be set only in advance cases.
 * recorder.mimeType = {
 *     audio: 'audio/wav',
 *     video: 'video/webm',
 *     gif:   'image/gif'
 * };
 * recorder.startRecording();
 * @see For further information:
 * @see {@link https://github.com/muaz-khan/RecordRTC/tree/master/MRecordRTC|MRecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @requires {@link RecordRTC}
 */function q(r){this.addStream=function(e){e&&(r=e)},this.mediaType={audio:!0,video:!0},this.startRecording=function(){var e=this.mediaType,t,a=this.mimeType||{audio:null,video:null,gif:null};if(typeof e.audio!="function"&&re()&&!x(r,"audio").length&&(e.audio=!1),typeof e.video!="function"&&re()&&!x(r,"video").length&&(e.video=!1),typeof e.gif!="function"&&re()&&!x(r,"video").length&&(e.gif=!1),!e.audio&&!e.video&&!e.gif)throw"MediaStream must have either audio or video tracks.";if(e.audio&&(t=null,typeof e.audio=="function"&&(t=e.audio),this.audioRecorder=new g(r,{type:"audio",bufferSize:this.bufferSize,sampleRate:this.sampleRate,numberOfAudioChannels:this.numberOfAudioChannels||2,disableLogs:this.disableLogs,recorderType:t,mimeType:a.audio,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp}),e.video||this.audioRecorder.startRecording()),e.video){t=null,typeof e.video=="function"&&(t=e.video);var d=r;if(re()&&e.audio&&typeof e.audio=="function"){var s=x(r,"video")[0];E?(d=new T,d.addTrack(s),t&&t===Ae&&(t=se)):(d=new T,d.addTrack(s))}this.videoRecorder=new g(d,{type:"video",video:this.video,canvas:this.canvas,frameInterval:this.frameInterval||10,disableLogs:this.disableLogs,recorderType:t,mimeType:a.video,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp,workerPath:this.workerPath,webAssemblyPath:this.webAssemblyPath,frameRate:this.frameRate,bitrate:this.bitrate}),e.audio||this.videoRecorder.startRecording()}if(e.audio&&e.video){var c=this,i=re()===!0;(e.audio instanceof ce&&e.video||e.audio!==!0&&e.video!==!0&&e.audio!==e.video)&&(i=!1),i===!0?(c.audioRecorder=null,c.videoRecorder.startRecording()):c.videoRecorder.initRecorder(function(){c.audioRecorder.initRecorder(function(){c.videoRecorder.startRecording(),c.audioRecorder.startRecording()})})}e.gif&&(t=null,typeof e.gif=="function"&&(t=e.gif),this.gifRecorder=new g(r,{type:"gif",frameRate:this.frameRate||200,quality:this.quality||10,disableLogs:this.disableLogs,recorderType:t,mimeType:a.gif}),this.gifRecorder.startRecording())},this.stopRecording=function(e){e=e||function(){},this.audioRecorder&&this.audioRecorder.stopRecording(function(t){e(t,"audio")}),this.videoRecorder&&this.videoRecorder.stopRecording(function(t){e(t,"video")}),this.gifRecorder&&this.gifRecorder.stopRecording(function(t){e(t,"gif")})},this.pauseRecording=function(){this.audioRecorder&&this.audioRecorder.pauseRecording(),this.videoRecorder&&this.videoRecorder.pauseRecording(),this.gifRecorder&&this.gifRecorder.pauseRecording()},this.resumeRecording=function(){this.audioRecorder&&this.audioRecorder.resumeRecording(),this.videoRecorder&&this.videoRecorder.resumeRecording(),this.gifRecorder&&this.gifRecorder.resumeRecording()},this.getBlob=function(e){var t={};return this.audioRecorder&&(t.audio=this.audioRecorder.getBlob()),this.videoRecorder&&(t.video=this.videoRecorder.getBlob()),this.gifRecorder&&(t.gif=this.gifRecorder.getBlob()),e&&e(t),t},this.destroy=function(){this.audioRecorder&&(this.audioRecorder.destroy(),this.audioRecorder=null),this.videoRecorder&&(this.videoRecorder.destroy(),this.videoRecorder=null),this.gifRecorder&&(this.gifRecorder.destroy(),this.gifRecorder=null)},this.getDataURL=function(e){this.getBlob(function(d){d.audio&&d.video?t(d.audio,function(s){t(d.video,function(c){e({audio:s,video:c})})}):d.audio?t(d.audio,function(s){e({audio:s})}):d.video&&t(d.video,function(s){e({video:s})})});function t(d,s){if(typeof Worker<"u"){var c=a(function(S){postMessage(new FileReaderSync().readAsDataURL(S))});c.onmessage=function(p){s(p.data)},c.postMessage(d)}else{var i=new FileReader;i.readAsDataURL(d),i.onload=function(p){s(p.target.result)}}}function a(d){var s=B.createObjectURL(new Blob([d.toString(),"this.onmessage =  function (eee) {"+d.name+"(eee.data);}"],{type:"application/javascript"})),c=new Worker(s),i;if(typeof B<"u")i=B;else if(typeof webkitURL<"u")i=webkitURL;else throw"Neither URL nor webkitURL detected.";return i.revokeObjectURL(s),c}},this.writeToDisk=function(){g.writeToDisk({audio:this.audioRecorder,video:this.videoRecorder,gif:this.gifRecorder})},this.save=function(e){e=e||{audio:!0,video:!0,gif:!0},e.audio&&this.audioRecorder&&this.audioRecorder.save(typeof e.audio=="string"?e.audio:""),e.video&&this.videoRecorder&&this.videoRecorder.save(typeof e.video=="string"?e.video:""),e.gif&&this.gifRecorder&&this.gifRecorder.save(typeof e.gif=="string"?e.gif:"")}}q.getFromDisk=g.getFromDisk,q.writeToDisk=g.writeToDisk,typeof g<"u"&&(g.MRecordRTC=q);var I="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";(function(r){r&&(typeof window<"u"||typeof J>"u"||(J.navigator={userAgent:I,getUserMedia:function(){}},J.console||(J.console={}),(typeof J.console.log>"u"||typeof J.console.error>"u")&&(J.console.error=J.console.log=J.console.log||function(){console.log(arguments)}),typeof document>"u"&&(r.document={documentElement:{appendChild:function(){return""}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""},style:{}};return e},r.HTMLVideoElement=function(){}),typeof location>"u"&&(r.location={protocol:"file:",href:"",hash:""}),typeof screen>"u"&&(r.screen={width:0,height:0}),typeof B>"u"&&(r.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),r.window=J))})(typeof J<"u"?J:null);var C=window.requestAnimationFrame;if(typeof C>"u"){if(typeof webkitRequestAnimationFrame<"u")C=webkitRequestAnimationFrame;else if(typeof mozRequestAnimationFrame<"u")C=mozRequestAnimationFrame;else if(typeof msRequestAnimationFrame<"u")C=msRequestAnimationFrame;else if(typeof C>"u"){var D=0;C=function(r,e){var t=new Date().getTime(),a=Math.max(0,16-(t-D)),d=setTimeout(function(){r(t+a)},a);return D=t+a,d}}}var U=window.cancelAnimationFrame;typeof U>"u"&&(typeof webkitCancelAnimationFrame<"u"?U=webkitCancelAnimationFrame:typeof mozCancelAnimationFrame<"u"?U=mozCancelAnimationFrame:typeof msCancelAnimationFrame<"u"?U=msCancelAnimationFrame:typeof U>"u"&&(U=function(r){clearTimeout(r)}));var K=window.AudioContext;typeof K>"u"&&(typeof webkitAudioContext<"u"&&(K=webkitAudioContext),typeof mozAudioContext<"u"&&(K=mozAudioContext));var B=window.URL;typeof B>"u"&&typeof webkitURL<"u"&&(B=webkitURL),typeof navigator<"u"&&typeof navigator.getUserMedia>"u"&&(typeof navigator.webkitGetUserMedia<"u"&&(navigator.getUserMedia=navigator.webkitGetUserMedia),typeof navigator.mozGetUserMedia<"u"&&(navigator.getUserMedia=navigator.mozGetUserMedia));var ae=navigator.userAgent.indexOf("Edge")!==-1&&(!!navigator.msSaveBlob||!!navigator.msSaveOrOpenBlob),A=!!window.opera||navigator.userAgent.indexOf("OPR/")!==-1,E=navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&"netscape"in window&&/ rv:/.test(navigator.userAgent),f=!A&&!ae&&!!navigator.webkitGetUserMedia||$()||navigator.userAgent.toLowerCase().indexOf("chrome/")!==-1,b=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);b&&!f&&navigator.userAgent.indexOf("CriOS")!==-1&&(b=!1,f=!0);var T=window.MediaStream;typeof T>"u"&&typeof webkitMediaStream<"u"&&(T=webkitMediaStream),typeof T<"u"&&typeof T.prototype.stop>"u"&&(T.prototype.stop=function(){this.getTracks().forEach(function(r){r.stop()})});function F(r){var e=1e3,t=["Bytes","KB","MB","GB","TB"];if(r===0)return"0 Bytes";var a=parseInt(Math.floor(Math.log(r)/Math.log(e)),10);return(r/Math.pow(e,a)).toPrecision(3)+" "+t[a]}function X(r,e){if(!r)throw"Blob object is required.";if(!r.type)try{r.type="video/webm"}catch{}var t=(r.type||"video/webm").split("/")[1];if(t.indexOf(";")!==-1&&(t=t.split(";")[0]),e&&e.indexOf(".")!==-1){var a=e.split(".");e=a[0],t=a[1]}var d=(e||Math.round(Math.random()*9999999999)+888888888)+"."+t;if(typeof navigator.msSaveOrOpenBlob<"u")return navigator.msSaveOrOpenBlob(r,d);if(typeof navigator.msSaveBlob<"u")return navigator.msSaveBlob(r,d);var s=document.createElement("a");s.href=B.createObjectURL(r),s.download=d,s.style="display:none;opacity:0;color:transparent;",(document.body||document.documentElement).appendChild(s),typeof s.click=="function"?s.click():(s.target="_blank",s.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0}))),B.revokeObjectURL(s.href)}function $(){return!!(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron||typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0)}function x(r,e){return!r||!r.getTracks?[]:r.getTracks().filter(function(t){return t.kind===(e||"audio")})}function Z(r,e){"srcObject"in e?e.srcObject=r:"mozSrcObject"in e?e.mozSrcObject=r:e.srcObject=r}function te(r,e){if(typeof EBML>"u")throw new Error("Please link: https://www.webrtc-experiment.com/EBML.js");var t=new EBML.Reader,a=new EBML.Decoder,d=EBML.tools,s=new FileReader;s.onload=function(c){var i=a.decode(this.result);i.forEach(function(w){t.read(w)}),t.stop();var p=d.makeMetadataSeekable(t.metadatas,t.duration,t.cues),S=this.result.slice(t.metadataSize),l=new Blob([p,S],{type:"video/webm"});e(l)},s.readAsArrayBuffer(r)}typeof g<"u"&&(g.invokeSaveAsDialog=X,g.getTracks=x,g.getSeekableBlob=te,g.bytesToSize=F,g.isElectron=$);/**
 * Storage is a standalone object used by {@link RecordRTC} to store reusable objects e.g. "new AudioContext".
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @example
 * Storage.AudioContext === webkitAudioContext
 * @property {webkitAudioContext} AudioContext - Keeps a reference to AudioContext object.
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 */var N={};typeof K<"u"?N.AudioContext=K:typeof webkitAudioContext<"u"&&(N.AudioContext=webkitAudioContext),typeof g<"u"&&(g.Storage=N);function re(){if(E||b||ae)return!0;var r=navigator.userAgent,e=""+parseFloat(navigator.appVersion),t=parseInt(navigator.appVersion,10),a,d;return(f||A)&&(a=r.indexOf("Chrome"),e=r.substring(a+7)),(d=e.indexOf(";"))!==-1&&(e=e.substring(0,d)),(d=e.indexOf(" "))!==-1&&(e=e.substring(0,d)),t=parseInt(""+e,10),isNaN(t)&&(e=""+parseFloat(navigator.appVersion),t=parseInt(navigator.appVersion,10)),t>=49}/**
 * MediaStreamRecorder is an abstraction layer for {@link https://w3c.github.io/mediacapture-record/MediaRecorder.html|MediaRecorder API}. It is used by {@link RecordRTC} to record MediaStream(s) in both Chrome and Firefox.
 * @summary Runs top over {@link https://w3c.github.io/mediacapture-record/MediaRecorder.html|MediaRecorder API}.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://github.com/muaz-khan|Muaz Khan}
 * @typedef MediaStreamRecorder
 * @class
 * @example
 * var config = {
 *     mimeType: 'video/webm', // vp8, vp9, h264, mkv, opus/vorbis
 *     audioBitsPerSecond : 256 * 8 * 1024,
 *     videoBitsPerSecond : 256 * 8 * 1024,
 *     bitsPerSecond: 256 * 8 * 1024,  // if this is provided, skip above two
 *     checkForInactiveTracks: true,
 *     timeSlice: 1000, // concatenate intervals based blobs
 *     ondataavailable: function() {} // get intervals based blobs
 * }
 * var recorder = new MediaStreamRecorder(mediaStream, config);
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 *
 *     // or
 *     var blob = recorder.blob;
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {disableLogs:true, initCallback: function, mimeType: "video/webm", timeSlice: 1000}
 * @throws Will throw an error if first argument "MediaStream" is missing. Also throws error if "MediaRecorder API" are not supported by the browser.
 */function se(r,e){var l=this;if(typeof r>"u")throw'First argument "MediaStream" is required.';if(typeof MediaRecorder>"u")throw"Your browser does not support the Media Recorder API. Please try other modules e.g. WhammyRecorder or StereoAudioRecorder.";if(e=e||{mimeType:"video/webm"},e.type==="audio"){if(x(r,"video").length&&x(r,"audio").length){var t;navigator.mozGetUserMedia?(t=new T,t.addTrack(x(r,"audio")[0])):t=new T(x(r,"audio")),r=t}(!e.mimeType||e.mimeType.toString().toLowerCase().indexOf("audio")===-1)&&(e.mimeType=f?"audio/webm":"audio/ogg"),e.mimeType&&e.mimeType.toString().toLowerCase()!=="audio/ogg"&&navigator.mozGetUserMedia&&(e.mimeType="audio/ogg")}var a=[];this.getArrayOfBlobs=function(){return a},this.record=function(){l.blob=null,l.clearRecordedData(),l.timestamps=[],S=[],a=[];var w=e;e.disableLogs||console.log("Passing following config over MediaRecorder API.",w),i&&(i=null),f&&!re()&&(w="video/vp8"),typeof MediaRecorder.isTypeSupported=="function"&&w.mimeType&&(MediaRecorder.isTypeSupported(w.mimeType)||(e.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",w.mimeType),w.mimeType=e.type==="audio"?"audio/webm":"video/webm"));try{i=new MediaRecorder(r,w),e.mimeType=w.mimeType}catch{i=new MediaRecorder(r)}w.mimeType&&!MediaRecorder.isTypeSupported&&"canRecordMimeType"in i&&i.canRecordMimeType(w.mimeType)===!1&&(e.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",w.mimeType)),i.ondataavailable=function(v){if(v.data&&S.push("ondataavailable: "+F(v.data.size)),typeof e.timeSlice=="number"){if(v.data&&v.data.size&&(a.push(v.data),d(),typeof e.ondataavailable=="function")){var y=e.getNativeBlob?v.data:new Blob([v.data],{type:s(w)});e.ondataavailable(y)}return}if(!v.data||!v.data.size||v.data.size<100||l.blob){l.recordingCallback&&(l.recordingCallback(new Blob([],{type:s(w)})),l.recordingCallback=null);return}l.blob=e.getNativeBlob?v.data:new Blob([v.data],{type:s(w)}),l.recordingCallback&&(l.recordingCallback(l.blob),l.recordingCallback=null)},i.onstart=function(){S.push("started")},i.onpause=function(){S.push("paused")},i.onresume=function(){S.push("resumed")},i.onstop=function(){S.push("stopped")},i.onerror=function(v){v&&(v.name||(v.name="UnknownError"),S.push("error: "+v),e.disableLogs||(v.name.toString().toLowerCase().indexOf("invalidstate")!==-1?console.error("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed.",v):v.name.toString().toLowerCase().indexOf("notsupported")!==-1?console.error("MIME type (",w.mimeType,") is not supported.",v):v.name.toString().toLowerCase().indexOf("security")!==-1?console.error("MediaRecorder security error",v):v.name==="OutOfMemory"?console.error("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute.",v):v.name==="IllegalStreamModification"?console.error("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute.",v):v.name==="OtherRecordingError"?console.error("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute.",v):v.name==="GenericError"?console.error("The UA cannot provide the codec or recording option that has been requested.",v):console.error("MediaRecorder Error",v)),function(y){if(!l.manuallyStopped&&i&&i.state==="inactive"){delete e.timeslice,i.start(10*60*1e3);return}setTimeout(y,1e3)}(),i.state!=="inactive"&&i.state!=="stopped"&&i.stop())},typeof e.timeSlice=="number"?(d(),i.start(e.timeSlice)):i.start(36e5),e.initCallback&&e.initCallback()},this.timestamps=[];function d(){l.timestamps.push(new Date().getTime()),typeof e.onTimeStamp=="function"&&e.onTimeStamp(l.timestamps[l.timestamps.length-1],l.timestamps)}function s(w){return i&&i.mimeType?i.mimeType:w.mimeType||"video/webm"}this.stop=function(w){w=w||function(){},l.manuallyStopped=!0,i&&(this.recordingCallback=w,i.state==="recording"&&i.stop(),typeof e.timeSlice=="number"&&setTimeout(function(){l.blob=new Blob(a,{type:s(e)}),l.recordingCallback(l.blob)},100))},this.pause=function(){i&&i.state==="recording"&&i.pause()},this.resume=function(){i&&i.state==="paused"&&i.resume()},this.clearRecordedData=function(){i&&i.state==="recording"&&l.stop(c),c()};function c(){a=[],i=null,l.timestamps=[]}var i;this.getInternalRecorder=function(){return i};function p(){if("active"in r){if(!r.active)return!1}else if("ended"in r&&r.ended)return!1;return!0}this.blob=null,this.getState=function(){return i&&i.state||"inactive"};var S=[];this.getAllStates=function(){return S},typeof e.checkForInactiveTracks>"u"&&(e.checkForInactiveTracks=!1);var l=this;(function w(){if(!(!i||e.checkForInactiveTracks===!1)){if(p()===!1){e.disableLogs||console.log("MediaStream seems stopped."),l.stop();return}setTimeout(w,1e3)}})(),this.name="MediaStreamRecorder",this.toString=function(){return this.name}}typeof g<"u"&&(g.MediaStreamRecorder=se);/**
 * StereoAudioRecorder is a standalone class used by {@link RecordRTC} to bring "stereo" audio-recording in chrome.
 * @summary JavaScript standalone object for stereo audio recording.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef StereoAudioRecorder
 * @class
 * @example
 * var recorder = new StereoAudioRecorder(MediaStream, {
 *     sampleRate: 44100,
 *     bufferSize: 4096
 * });
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {sampleRate: 44100, bufferSize: 4096, numberOfAudioChannels: 1, etc.}
 */function ce(r,e){if(!x(r,"audio").length)throw"Your stream has no audio tracks.";e=e||{};var t=this,a=[],d=[],s=!1,c=0,i,p=2,S=e.desiredSampRate;e.leftChannel===!0&&(p=1),e.numberOfAudioChannels===1&&(p=1),(!p||p<1)&&(p=2),e.disableLogs||console.log("StereoAudioRecorder is set to record number of channels: "+p),typeof e.checkForInactiveTracks>"u"&&(e.checkForInactiveTracks=!0);function l(){if(e.checkForInactiveTracks===!1)return!0;if("active"in r){if(!r.active)return!1}else if("ended"in r&&r.ended)return!1;return!0}this.record=function(){if(l()===!1)throw"Please make sure MediaStream is active.";j(),u=R=!1,s=!0,typeof e.timeSlice<"u"&&W()};function w(O,oe){function de(ie,Ue){var ge=ie.numberOfAudioChannels,he=ie.leftBuffers.slice(0),xe=ie.rightBuffers.slice(0),pe=ie.sampleRate,Ce=ie.internalInterleavedLength,be=ie.desiredSampRate;ge===2&&(he=We(he,Ce),xe=We(xe,Ce),be&&(he=Ie(he,be,pe),xe=Ie(xe,be,pe))),ge===1&&(he=We(he,Ce),be&&(he=Ie(he,be,pe))),be&&(pe=be);function Ie(ne,we,ve){var me=Math.round(ne.length*(we/ve)),fe=[],Me=Number((ne.length-1)/(me-1));fe[0]=ne[0];for(var Le=1;Le<me-1;Le++){var Ge=Le*Me,it=Number(Math.floor(Ge)).toFixed(),Ct=Number(Math.ceil(Ge)).toFixed(),Mt=Ge-it;fe[Le]=yt(ne[it],ne[Ct],Mt)}return fe[me-1]=ne[ne.length-1],fe}function yt(ne,we,ve){return ne+(we-ne)*ve}function We(ne,we){for(var ve=new Float64Array(we),me=0,fe=ne.length,Me=0;Me<fe;Me++){var Le=ne[Me];ve.set(Le,me),me+=Le.length}return ve}function wt(ne,we){for(var ve=ne.length+we.length,me=new Float64Array(ve),fe=0,Me=0;Me<ve;)me[Me++]=ne[fe],me[Me++]=we[fe],fe++;return me}function Ee(ne,we,ve){for(var me=ve.length,fe=0;fe<me;fe++)ne.setUint8(we+fe,ve.charCodeAt(fe))}var Oe;ge===2&&(Oe=wt(he,xe)),ge===1&&(Oe=he);var Pe=Oe.length,Rt=44+Pe*2,Ne=new ArrayBuffer(Rt),ue=new DataView(Ne);Ee(ue,0,"RIFF"),ue.setUint32(4,36+Pe*2,!0),Ee(ue,8,"WAVE"),Ee(ue,12,"fmt "),ue.setUint32(16,16,!0),ue.setUint16(20,1,!0),ue.setUint16(22,ge,!0),ue.setUint32(24,pe,!0),ue.setUint32(28,pe*ge*2,!0),ue.setUint16(32,ge*2,!0),ue.setUint16(34,16,!0),Ee(ue,36,"data"),ue.setUint32(40,Pe*2,!0);for(var St=Pe,rt=44,xt=1,Ve=0;Ve<St;Ve++)ue.setInt16(rt,Oe[Ve]*(32767*xt),!0),rt+=2;if(Ue)return Ue({buffer:Ne,view:ue});postMessage({buffer:Ne,view:ue})}if(O.noWorker){de(O,function(ie){oe(ie.buffer,ie.view)});return}var Se=v(de);Se.onmessage=function(ie){oe(ie.data.buffer,ie.data.view),B.revokeObjectURL(Se.workerURL),Se.terminate()},Se.postMessage(O)}function v(O){var oe=B.createObjectURL(new Blob([O.toString(),";this.onmessage =  function (eee) {"+O.name+"(eee.data);}"],{type:"application/javascript"})),de=new Worker(oe);return de.workerURL=oe,de}this.stop=function(O){O=O||function(){},s=!1,w({desiredSampRate:S,sampleRate:o,numberOfAudioChannels:p,internalInterleavedLength:c,leftBuffers:a,rightBuffers:p===1?[]:d,noWorker:e.noWorker},function(oe,de){t.blob=new Blob([de],{type:"audio/wav"}),t.buffer=new ArrayBuffer(de.buffer.byteLength),t.view=de,t.sampleRate=S||o,t.bufferSize=P,t.length=c,u=!1,O&&O(t.blob)})},typeof g.Storage>"u"&&(g.Storage={AudioContextConstructor:null,AudioContext:window.AudioContext||window.webkitAudioContext}),(!g.Storage.AudioContextConstructor||g.Storage.AudioContextConstructor.state==="closed")&&(g.Storage.AudioContextConstructor=new g.Storage.AudioContext);var y=g.Storage.AudioContextConstructor,h=y.createMediaStreamSource(r),k=[0,256,512,1024,2048,4096,8192,16384],P=typeof e.bufferSize>"u"?4096:e.bufferSize;if(k.indexOf(P)===-1&&(e.disableLogs||console.log("Legal values for buffer-size are "+JSON.stringify(k,null,"	"))),y.createJavaScriptNode)i=y.createJavaScriptNode(P,p,p);else if(y.createScriptProcessor)i=y.createScriptProcessor(P,p,p);else throw"WebAudio API has no support on this browser.";h.connect(i),e.bufferSize||(P=i.bufferSize);var o=typeof e.sampleRate<"u"?e.sampleRate:y.sampleRate||44100;(o<22050||o>96e3)&&(e.disableLogs||console.log("sample-rate must be under range 22050 and 96000.")),e.disableLogs||e.desiredSampRate&&console.log("Desired sample-rate: "+e.desiredSampRate);var R=!1;this.pause=function(){R=!0},this.resume=function(){if(l()===!1)throw"Please make sure MediaStream is active.";if(!s){e.disableLogs||console.log("Seems recording has been restarted."),this.record();return}R=!1},this.clearRecordedData=function(){e.checkForInactiveTracks=!1,s&&this.stop(n),n()};function j(){a=[],d=[],c=0,u=!1,s=!1,R=!1,y=null,t.leftchannel=a,t.rightchannel=d,t.numberOfAudioChannels=p,t.desiredSampRate=S,t.sampleRate=o,t.recordingLength=c,L={left:[],right:[],recordingLength:0}}function n(){i&&(i.onaudioprocess=null,i.disconnect(),i=null),h&&(h.disconnect(),h=null),j()}this.name="StereoAudioRecorder",this.toString=function(){return this.name};var u=!1;function M(O){if(!R){if(l()===!1&&(e.disableLogs||console.log("MediaStream seems stopped."),i.disconnect(),s=!1),!s){h&&(h.disconnect(),h=null);return}u||(u=!0,e.onAudioProcessStarted&&e.onAudioProcessStarted(),e.initCallback&&e.initCallback());var oe=O.inputBuffer.getChannelData(0),de=new Float32Array(oe);if(a.push(de),p===2){var Se=O.inputBuffer.getChannelData(1),ie=new Float32Array(Se);d.push(ie)}c+=P,t.recordingLength=c,typeof e.timeSlice<"u"&&(L.recordingLength+=P,L.left.push(de),p===2&&L.right.push(ie))}}i.onaudioprocess=M,y.createMediaStreamDestination?i.connect(y.createMediaStreamDestination()):i.connect(y.destination),this.leftchannel=a,this.rightchannel=d,this.numberOfAudioChannels=p,this.desiredSampRate=S,this.sampleRate=o,t.recordingLength=c;var L={left:[],right:[],recordingLength:0};function W(){!s||typeof e.ondataavailable!="function"||typeof e.timeSlice>"u"||(L.left.length?(w({desiredSampRate:S,sampleRate:o,numberOfAudioChannels:p,internalInterleavedLength:L.recordingLength,leftBuffers:L.left,rightBuffers:p===1?[]:L.right},function(O,oe){var de=new Blob([oe],{type:"audio/wav"});e.ondataavailable(de),setTimeout(W,e.timeSlice)}),L={left:[],right:[],recordingLength:0}):setTimeout(W,e.timeSlice))}}typeof g<"u"&&(g.StereoAudioRecorder=ce);/**
 * CanvasRecorder is a standalone class used by {@link RecordRTC} to bring HTML5-Canvas recording into video WebM. It uses HTML2Canvas library and runs top over {@link Whammy}.
 * @summary HTML2Canvas recording into video WebM.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef CanvasRecorder
 * @class
 * @example
 * var recorder = new CanvasRecorder(htmlElement, { disableLogs: true, useWhammyRecorder: true });
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {HTMLElement} htmlElement - querySelector/getElementById/getElementsByTagName[0]/etc.
 * @param {object} config - {disableLogs:true, initCallback: function}
 */function Re(r,e){if(typeof html2canvas>"u")throw"Please link: https://www.webrtc-experiment.com/screenshot.js";e=e||{},e.frameInterval||(e.frameInterval=10);var t=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(k){k in document.createElement("canvas")&&(t=!0)});var a=(!!window.webkitRTCPeerConnection||!!window.webkitGetUserMedia)&&!!window.chrome,d=50,s=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);a&&s&&s[2]&&(d=parseInt(s[2],10)),a&&d<52&&(t=!1),e.useWhammyRecorder&&(t=!1);var c,i;if(t)if(e.disableLogs||console.log("Your browser supports both MediRecorder API and canvas.captureStream!"),r instanceof HTMLCanvasElement)c=r;else if(r instanceof CanvasRenderingContext2D)c=r.canvas;else throw"Please pass either HTMLCanvasElement or CanvasRenderingContext2D.";else navigator.mozGetUserMedia&&(e.disableLogs||console.error("Canvas recording is NOT supported in Firefox."));var p;this.record=function(){if(p=!0,t&&!e.useWhammyRecorder){var k;"captureStream"in c?k=c.captureStream(25):"mozCaptureStream"in c?k=c.mozCaptureStream(25):"webkitCaptureStream"in c&&(k=c.webkitCaptureStream(25));try{var P=new T;P.addTrack(x(k,"video")[0]),k=P}catch{}if(!k)throw"captureStream API are NOT available.";i=new se(k,{mimeType:e.mimeType||"video/webm"}),i.record()}else h.frames=[],y=new Date().getTime(),v();e.initCallback&&e.initCallback()},this.getWebPImages=function(k){if(r.nodeName.toLowerCase()!=="canvas"){k();return}var P=h.frames.length;h.frames.forEach(function(o,R){var j=P-R;e.disableLogs||console.log(j+"/"+P+" frames remaining"),e.onEncodingCallback&&e.onEncodingCallback(j,P);var n=o.image.toDataURL("image/webp",1);h.frames[R].image=n}),e.disableLogs||console.log("Generating WebM"),k()},this.stop=function(k){p=!1;var P=this;if(t&&i){i.stop(k);return}this.getWebPImages(function(){h.compile(function(o){e.disableLogs||console.log("Recording finished!"),P.blob=o,P.blob.forEach&&(P.blob=new Blob([],{type:"video/webm"})),k&&k(P.blob),h.frames=[]})})};var S=!1;this.pause=function(){if(S=!0,i instanceof se){i.pause();return}},this.resume=function(){if(S=!1,i instanceof se){i.resume();return}p||this.record()},this.clearRecordedData=function(){p&&this.stop(l),l()};function l(){h.frames=[],p=!1,S=!1}this.name="CanvasRecorder",this.toString=function(){return this.name};function w(){var k=document.createElement("canvas"),P=k.getContext("2d");return k.width=r.width,k.height=r.height,P.drawImage(r,0,0),k}function v(){if(S)return y=new Date().getTime(),setTimeout(v,500);if(r.nodeName.toLowerCase()==="canvas"){var k=new Date().getTime()-y;y=new Date().getTime(),h.frames.push({image:w(),duration:k}),p&&setTimeout(v,e.frameInterval);return}html2canvas(r,{grabMouse:typeof e.showMousePointer>"u"||e.showMousePointer,onrendered:function(P){var o=new Date().getTime()-y;if(!o)return setTimeout(v,e.frameInterval);y=new Date().getTime(),h.frames.push({image:P.toDataURL("image/webp",1),duration:o}),p&&setTimeout(v,e.frameInterval)}})}var y=new Date().getTime(),h=new De.Video(100)}typeof g<"u"&&(g.CanvasRecorder=Re);/**
 * WhammyRecorder is a standalone class used by {@link RecordRTC} to bring video recording in Chrome. It runs top over {@link Whammy}.
 * @summary Video recording feature in Chrome.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef WhammyRecorder
 * @class
 * @example
 * var recorder = new WhammyRecorder(mediaStream);
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {disableLogs: true, initCallback: function, video: HTMLVideoElement, etc.}
 */function Ae(r,e){e=e||{},e.frameInterval||(e.frameInterval=10),e.disableLogs||console.log("Using frames-interval:",e.frameInterval),this.record=function(){e.width||(e.width=320),e.height||(e.height=240),e.video||(e.video={width:e.width,height:e.height}),e.canvas||(e.canvas={width:e.width,height:e.height}),p.width=e.canvas.width||320,p.height=e.canvas.height||240,S=p.getContext("2d"),e.video&&e.video instanceof HTMLVideoElement?(l=e.video.cloneNode(),e.initCallback&&e.initCallback()):(l=document.createElement("video"),Z(r,l),l.onloadedmetadata=function(){e.initCallback&&e.initCallback()},l.width=e.video.width,l.height=e.video.height),l.muted=!0,l.play(),w=new Date().getTime(),v=new De.Video,e.disableLogs||(console.log("canvas resolutions",p.width,"*",p.height),console.log("video width/height",l.width||p.width,"*",l.height||p.height)),t(e.frameInterval)};function t(y){y=typeof y<"u"?y:10;var h=new Date().getTime()-w;if(!h)return setTimeout(t,y,y);if(c)return w=new Date().getTime(),setTimeout(t,100);w=new Date().getTime(),l.paused&&l.play(),S.drawImage(l,0,0,p.width,p.height),v.frames.push({duration:h,image:p.toDataURL("image/webp")}),s||setTimeout(t,y,y)}function a(y){var h=-1,k=y.length;(function P(){if(h++,h===k){y.callback();return}setTimeout(function(){y.functionToLoop(P,h)},1)})()}function d(y,h,k,P,o){var R=document.createElement("canvas");R.width=p.width,R.height=p.height;var j=R.getContext("2d"),n=[],u=y.length,M={r:0,g:0,b:0},L=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),W=0,O=0,oe=!1;a({length:u,functionToLoop:function(de,Se){var ie,Ue,ge,he=function(){!oe&&ge-ie<=ge*O||(oe=!0,n.push(y[Se])),de()};if(oe)he();else{var xe=new Image;xe.onload=function(){j.drawImage(xe,0,0,p.width,p.height);var pe=j.getImageData(0,0,p.width,p.height);ie=0,Ue=pe.data.length,ge=pe.data.length/4;for(var Ce=0;Ce<Ue;Ce+=4){var be={r:pe.data[Ce],g:pe.data[Ce+1],b:pe.data[Ce+2]},Ie=Math.sqrt(Math.pow(be.r-M.r,2)+Math.pow(be.g-M.g,2)+Math.pow(be.b-M.b,2));Ie<=L*W&&ie++}he()},xe.src=y[Se].image}},callback:function(){n=n.concat(y.slice(u)),n.length<=0&&n.push(y[y.length-1]),o(n)}})}var s=!1;this.stop=function(y){y=y||function(){},s=!0;var h=this;setTimeout(function(){d(v.frames,-1,null,null,function(k){v.frames=k,e.advertisement&&e.advertisement.length&&(v.frames=e.advertisement.concat(v.frames)),v.compile(function(P){h.blob=P,h.blob.forEach&&(h.blob=new Blob([],{type:"video/webm"})),y&&y(h.blob)})})},10)};var c=!1;this.pause=function(){c=!0},this.resume=function(){c=!1,s&&this.record()},this.clearRecordedData=function(){s||this.stop(i),i()};function i(){v.frames=[],s=!0,c=!1}this.name="WhammyRecorder",this.toString=function(){return this.name};var p=document.createElement("canvas"),S=p.getContext("2d"),l,w,v}typeof g<"u"&&(g.WhammyRecorder=Ae);/**
 * Whammy is a standalone class used by {@link RecordRTC} to bring video recording in Chrome. It is written by {@link https://github.com/antimatter15|antimatter15}
 * @summary A real time javascript webm encoder based on a canvas hack.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef Whammy
 * @class
 * @example
 * var recorder = new Whammy().Video(15);
 * recorder.add(context || canvas || dataURL);
 * var output = recorder.compile();
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 */var De=function(){function r(a){this.frames=[],this.duration=a||1,this.quality=.8}r.prototype.add=function(a,d){if("canvas"in a&&(a=a.canvas),"toDataURL"in a&&(a=a.toDataURL("image/webp",this.quality)),!/^data:image\/webp;base64,/ig.test(a))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:a,duration:d||this.duration})};function e(a){var d=B.createObjectURL(new Blob([a.toString(),"this.onmessage =  function (eee) {"+a.name+"(eee.data);}"],{type:"application/javascript"})),s=new Worker(d);return B.revokeObjectURL(d),s}function t(a){function d(o){var R=c(o);if(!R)return[];for(var j=3e4,n=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:k(R.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:R.width,id:176},{data:R.height,id:186}]}]}]}]}],u=0,M=0;u<o.length;){var L=[],W=0;do L.push(o[u]),W+=o[u].duration,u++;while(u<o.length&&W<j);var O=0,oe={id:524531317,data:s(M,O,L)};n[1].data.push(oe),M+=W}return l(n)}function s(o,R,j){return[{data:o,id:231}].concat(j.map(function(n){var u=w({discardable:0,frame:n.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(R)});return R+=n.duration,{data:u,id:163}}))}function c(o){if(!o[0]){postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."});return}for(var R=o[0].width,j=o[0].height,n=o[0].duration,u=1;u<o.length;u++)n+=o[u].duration;return{duration:n,width:R,height:j}}function i(o){for(var R=[];o>0;)R.push(o&255),o=o>>8;return new Uint8Array(R.reverse())}function p(o){return new Uint8Array(o.split("").map(function(R){return R.charCodeAt(0)}))}function S(o){var R=[],j=o.length%8?new Array(9-o.length%8).join("0"):"";o=j+o;for(var n=0;n<o.length;n+=8)R.push(parseInt(o.substr(n,8),2));return new Uint8Array(R)}function l(o){for(var R=[],j=0;j<o.length;j++){var n=o[j].data;typeof n=="object"&&(n=l(n)),typeof n=="number"&&(n=S(n.toString(2))),typeof n=="string"&&(n=p(n));var u=n.size||n.byteLength||n.length,M=Math.ceil(Math.ceil(Math.log(u)/Math.log(2))/8),L=u.toString(2),W=new Array(M*7+7+1-L.length).join("0")+L,O=new Array(M).join("0")+"1"+W;R.push(i(o[j].id)),R.push(S(O)),R.push(n)}return new Blob(R,{type:"video/webm"})}function w(o){var R=0;if(R|=128,o.trackNum>127)throw"TrackNumber > 127 not supported";var j=[o.trackNum|128,o.timecode>>8,o.timecode&255,R].map(function(n){return String.fromCharCode(n)}).join("")+o.frame;return j}function v(o){for(var R=o.RIFF[0].WEBP[0],j=R.indexOf("¬ù*"),n=0,u=[];n<4;n++)u[n]=R.charCodeAt(j+3+n);var M,L,W;return W=u[1]<<8|u[0],M=W&16383,W=u[3]<<8|u[2],L=W&16383,{width:M,height:L,data:R,riff:o}}function y(o,R){return parseInt(o.substr(R+4,4).split("").map(function(j){var n=j.charCodeAt(0).toString(2);return new Array(8-n.length+1).join("0")+n}).join(""),2)}function h(o){for(var R=0,j={};R<o.length;){var n=o.substr(R,4),u=y(o,R),M=o.substr(R+4+4,u);R+=8+u,j[n]=j[n]||[],n==="RIFF"||n==="LIST"?j[n].push(h(M)):j[n].push(M)}return j}function k(o){return[].slice.call(new Uint8Array(new Float64Array([o]).buffer),0).map(function(R){return String.fromCharCode(R)}).reverse().join("")}var P=new d(a.map(function(o){var R=v(h(atob(o.image.slice(23))));return R.duration=o.duration,R}));postMessage(P)}return r.prototype.compile=function(a){var d=e(t);d.onmessage=function(s){if(s.data.error){console.error(s.data.error);return}a(s.data)},d.postMessage(this.frames)},{Video:r}}();typeof g<"u"&&(g.Whammy=De);/**
 * DiskStorage is a standalone object used by {@link RecordRTC} to store recorded blobs in IndexedDB storage.
 * @summary Writing blobs into IndexedDB.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @example
 * DiskStorage.Store({
 *     audioBlob: yourAudioBlob,
 *     videoBlob: yourVideoBlob,
 *     gifBlob  : yourGifBlob
 * });
 * DiskStorage.Fetch(function(dataURL, type) {
 *     if(type === 'audioBlob') { }
 *     if(type === 'videoBlob') { }
 *     if(type === 'gifBlob')   { }
 * });
 * // DiskStorage.dataStoreName = 'recordRTC';
 * // DiskStorage.onError = function(error) { };
 * @property {function} init - This method must be called once to initialize IndexedDB ObjectStore. Though, it is auto-used internally.
 * @property {function} Fetch - This method fetches stored blobs from IndexedDB.
 * @property {function} Store - This method stores blobs in IndexedDB.
 * @property {function} onError - This function is invoked for any known/unknown error.
 * @property {string} dataStoreName - Name of the ObjectStore created in IndexedDB storage.
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 */var le={init:function(){var r=this;if(typeof indexedDB>"u"||typeof indexedDB.open>"u"){console.error("IndexedDB API are not available in this browser.");return}var e=1,t=this.dbName||location.href.replace(/\/|:|#|%|\.|\[|\]/g,""),a,d=indexedDB.open(t,e);function s(i){i.createObjectStore(r.dataStoreName)}function c(){var i=a.transaction([r.dataStoreName],"readwrite");r.videoBlob&&i.objectStore(r.dataStoreName).put(r.videoBlob,"videoBlob"),r.gifBlob&&i.objectStore(r.dataStoreName).put(r.gifBlob,"gifBlob"),r.audioBlob&&i.objectStore(r.dataStoreName).put(r.audioBlob,"audioBlob");function p(S){i.objectStore(r.dataStoreName).get(S).onsuccess=function(l){r.callback&&r.callback(l.target.result,S)}}p("audioBlob"),p("videoBlob"),p("gifBlob")}d.onerror=r.onError,d.onsuccess=function(){if(a=d.result,a.onerror=r.onError,a.setVersion)if(a.version!==e){var i=a.setVersion(e);i.onsuccess=function(){s(a),c()}}else c();else c()},d.onupgradeneeded=function(i){s(i.target.result)}},Fetch:function(r){return this.callback=r,this.init(),this},Store:function(r){return this.audioBlob=r.audioBlob,this.videoBlob=r.videoBlob,this.gifBlob=r.gifBlob,this.init(),this},onError:function(r){console.error(JSON.stringify(r,null,"	"))},dataStoreName:"recordRTC",dbName:null};typeof g<"u"&&(g.DiskStorage=le);/**
 * GifRecorder is standalone calss used by {@link RecordRTC} to record video or canvas into animated gif.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef GifRecorder
 * @class
 * @example
 * var recorder = new GifRecorder(mediaStream || canvas || context, { onGifPreview: function, onGifRecordingStarted: function, width: 1280, height: 720, frameRate: 200, quality: 10 });
 * recorder.record();
 * recorder.stop(function(blob) {
 *     img.src = URL.createObjectURL(blob);
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object or HTMLCanvasElement or CanvasRenderingContext2D.
 * @param {object} config - {disableLogs:true, initCallback: function, width: 320, height: 240, frameRate: 200, quality: 10}
 */function ke(r,e){if(typeof GIFEncoder>"u"){var t=document.createElement("script");t.src="https://www.webrtc-experiment.com/gif-recorder.js",(document.body||document.documentElement).appendChild(t)}e=e||{};var a=r instanceof CanvasRenderingContext2D||r instanceof HTMLCanvasElement;this.record=function(){if(typeof GIFEncoder>"u"){setTimeout(y.record,1e3);return}if(!p){setTimeout(y.record,1e3);return}a||(e.width||(e.width=S.offsetWidth||320),e.height||(e.height=S.offsetHeight||240),e.video||(e.video={width:e.width,height:e.height}),e.canvas||(e.canvas={width:e.width,height:e.height}),c.width=e.canvas.width||320,c.height=e.canvas.height||240,S.width=e.video.width||320,S.height=e.video.height||240),v=new GIFEncoder,v.setRepeat(0),v.setDelay(e.frameRate||200),v.setQuality(e.quality||10),v.start(),typeof e.onGifRecordingStarted=="function"&&e.onGifRecordingStarted();function h(k){if(y.clearedRecordedData!==!0){if(d)return setTimeout(function(){h(k)},100);l=C(h),typeof w===void 0&&(w=k),!(k-w<90)&&(!a&&S.paused&&S.play(),a||i.drawImage(S,0,0,c.width,c.height),e.onGifPreview&&e.onGifPreview(c.toDataURL("image/png")),v.addFrame(i),w=k)}}l=C(h),e.initCallback&&e.initCallback()},this.stop=function(h){h=h||function(){},l&&U(l),this.blob=new Blob([new Uint8Array(v.stream().bin)],{type:"image/gif"}),h(this.blob),v.stream().bin=[]};var d=!1;this.pause=function(){d=!0},this.resume=function(){d=!1},this.clearRecordedData=function(){y.clearedRecordedData=!0,s()};function s(){v&&(v.stream().bin=[])}this.name="GifRecorder",this.toString=function(){return this.name};var c=document.createElement("canvas"),i=c.getContext("2d");a&&(r instanceof CanvasRenderingContext2D?(i=r,c=i.canvas):r instanceof HTMLCanvasElement&&(i=r.getContext("2d"),c=r));var p=!0;if(!a){var S=document.createElement("video");S.muted=!0,S.autoplay=!0,S.playsInline=!0,p=!1,S.onloadedmetadata=function(){p=!0},Z(r,S),S.play()}var l=null,w,v,y=this}typeof g<"u"&&(g.GifRecorder=ke);function je(r,e){var t="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";(function(n){typeof g<"u"||n&&(typeof window<"u"||typeof J>"u"||(J.navigator={userAgent:t,getUserMedia:function(){}},J.console||(J.console={}),(typeof J.console.log>"u"||typeof J.console.error>"u")&&(J.console.error=J.console.log=J.console.log||function(){console.log(arguments)}),typeof document>"u"&&(n.document={documentElement:{appendChild:function(){return""}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var u={getContext:function(){return u},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""},style:{}};return u},n.HTMLVideoElement=function(){}),typeof location>"u"&&(n.location={protocol:"file:",href:"",hash:""}),typeof screen>"u"&&(n.screen={width:0,height:0}),typeof S>"u"&&(n.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),n.window=J))})(typeof J<"u"?J:null),e=e||"multi-streams-mixer";var a=[],d=!1,s=document.createElement("canvas"),c=s.getContext("2d");s.style.opacity=0,s.style.position="absolute",s.style.zIndex=-1,s.style.top="-1000em",s.style.left="-1000em",s.className=e,(document.body||document.documentElement).appendChild(s),this.disableLogs=!1,this.frameInterval=10,this.width=360,this.height=240,this.useGainNode=!0;var i=this,p=window.AudioContext;typeof p>"u"&&(typeof webkitAudioContext<"u"&&(p=webkitAudioContext),typeof mozAudioContext<"u"&&(p=mozAudioContext));var S=window.URL;typeof S>"u"&&typeof webkitURL<"u"&&(S=webkitURL),typeof navigator<"u"&&typeof navigator.getUserMedia>"u"&&(typeof navigator.webkitGetUserMedia<"u"&&(navigator.getUserMedia=navigator.webkitGetUserMedia),typeof navigator.mozGetUserMedia<"u"&&(navigator.getUserMedia=navigator.mozGetUserMedia));var l=window.MediaStream;typeof l>"u"&&typeof webkitMediaStream<"u"&&(l=webkitMediaStream),typeof l<"u"&&typeof l.prototype.stop>"u"&&(l.prototype.stop=function(){this.getTracks().forEach(function(n){n.stop()})});var w={};typeof p<"u"?w.AudioContext=p:typeof webkitAudioContext<"u"&&(w.AudioContext=webkitAudioContext);function v(n,u){"srcObject"in u?u.srcObject=n:"mozSrcObject"in u?u.mozSrcObject=n:u.srcObject=n}this.startDrawingFrames=function(){y()};function y(){if(!d){var n=a.length,u=!1,M=[];if(a.forEach(function(W){W.stream||(W.stream={}),W.stream.fullcanvas?u=W:M.push(W)}),u)s.width=u.stream.width,s.height=u.stream.height;else if(M.length){s.width=n>1?M[0].width*2:M[0].width;var L=1;(n===3||n===4)&&(L=2),(n===5||n===6)&&(L=3),(n===7||n===8)&&(L=4),(n===9||n===10)&&(L=5),s.height=M[0].height*L}else s.width=i.width||360,s.height=i.height||240;u&&u instanceof HTMLVideoElement&&h(u),M.forEach(function(W,O){h(W,O)}),setTimeout(y,i.frameInterval)}}function h(n,u){if(!d){var M=0,L=0,W=n.width,O=n.height;u===1&&(M=n.width),u===2&&(L=n.height),u===3&&(M=n.width,L=n.height),u===4&&(L=n.height*2),u===5&&(M=n.width,L=n.height*2),u===6&&(L=n.height*3),u===7&&(M=n.width,L=n.height*3),typeof n.stream.left<"u"&&(M=n.stream.left),typeof n.stream.top<"u"&&(L=n.stream.top),typeof n.stream.width<"u"&&(W=n.stream.width),typeof n.stream.height<"u"&&(O=n.stream.height),c.drawImage(n,M,L,W,O),typeof n.stream.onRender=="function"&&n.stream.onRender(c,M,L,W,O,u)}}function k(){d=!1;var n=P(),u=o();return u&&u.getTracks().filter(function(M){return M.kind==="audio"}).forEach(function(M){n.addTrack(M)}),r.forEach(function(M){M.fullcanvas}),n}function P(){j();var n;"captureStream"in s?n=s.captureStream():"mozCaptureStream"in s?n=s.mozCaptureStream():i.disableLogs||console.error("Upgrade to latest Chrome or otherwise enable this flag: chrome://flags/#enable-experimental-web-platform-features");var u=new l;return n.getTracks().filter(function(M){return M.kind==="video"}).forEach(function(M){u.addTrack(M)}),s.stream=u,u}function o(){w.AudioContextConstructor||(w.AudioContextConstructor=new w.AudioContext),i.audioContext=w.AudioContextConstructor,i.audioSources=[],i.useGainNode===!0&&(i.gainNode=i.audioContext.createGain(),i.gainNode.connect(i.audioContext.destination),i.gainNode.gain.value=0);var n=0;if(r.forEach(function(u){if(u.getTracks().filter(function(L){return L.kind==="audio"}).length){n++;var M=i.audioContext.createMediaStreamSource(u);i.useGainNode===!0&&M.connect(i.gainNode),i.audioSources.push(M)}}),!!n)return i.audioDestination=i.audioContext.createMediaStreamDestination(),i.audioSources.forEach(function(u){u.connect(i.audioDestination)}),i.audioDestination.stream}function R(n){var u=document.createElement("video");return v(n,u),u.className=e,u.muted=!0,u.volume=0,u.width=n.width||i.width||360,u.height=n.height||i.height||240,u.play(),u}this.appendStreams=function(n){if(!n)throw"First parameter is required.";n instanceof Array||(n=[n]),n.forEach(function(u){var M=new l;if(u.getTracks().filter(function(O){return O.kind==="video"}).length){var L=R(u);L.stream=u,a.push(L),M.addTrack(u.getTracks().filter(function(O){return O.kind==="video"})[0])}if(u.getTracks().filter(function(O){return O.kind==="audio"}).length){var W=i.audioContext.createMediaStreamSource(u);i.audioDestination=i.audioContext.createMediaStreamDestination(),W.connect(i.audioDestination),M.addTrack(i.audioDestination.stream.getTracks().filter(function(O){return O.kind==="audio"})[0])}r.push(M)})},this.releaseStreams=function(){a=[],d=!0,i.gainNode&&(i.gainNode.disconnect(),i.gainNode=null),i.audioSources.length&&(i.audioSources.forEach(function(n){n.disconnect()}),i.audioSources=[]),i.audioDestination&&(i.audioDestination.disconnect(),i.audioDestination=null),i.audioContext&&i.audioContext.close(),i.audioContext=null,c.clearRect(0,0,s.width,s.height),s.stream&&(s.stream.stop(),s.stream=null)},this.resetVideoStreams=function(n){n&&!(n instanceof Array)&&(n=[n]),j(n)};function j(n){a=[],n=n||r,n.forEach(function(u){if(u.getTracks().filter(function(L){return L.kind==="video"}).length){var M=R(u);M.stream=u,a.push(M)}})}this.name="MultiStreamsMixer",this.toString=function(){return this.name},this.getMixedStream=k}typeof g>"u"&&(V.exports=je);/**
 * MultiStreamRecorder can record multiple videos in single container.
 * @summary Multi-videos recorder.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef MultiStreamRecorder
 * @class
 * @example
 * var options = {
 *     mimeType: 'video/webm'
 * }
 * var recorder = new MultiStreamRecorder(ArrayOfMediaStreams, options);
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 *
 *     // or
 *     var blob = recorder.blob;
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStreams} mediaStreams - Array of MediaStreams.
 * @param {object} config - {disableLogs:true, frameInterval: 1, mimeType: "video/webm"}
 */function z(r,e){r=r||[];var t=this,a,d;e=e||{elementClass:"multi-streams-mixer",mimeType:"video/webm",video:{width:360,height:240}},e.frameInterval||(e.frameInterval=10),e.video||(e.video={}),e.video.width||(e.video.width=360),e.video.height||(e.video.height=240),this.record=function(){a=new je(r,e.elementClass||"multi-streams-mixer"),s().length&&(a.frameInterval=e.frameInterval||10,a.width=e.video.width||360,a.height=e.video.height||240,a.startDrawingFrames()),e.previewStream&&typeof e.previewStream=="function"&&e.previewStream(a.getMixedStream()),d=new se(a.getMixedStream(),e),d.record()};function s(){var c=[];return r.forEach(function(i){x(i,"video").forEach(function(p){c.push(p)})}),c}this.stop=function(c){d&&d.stop(function(i){t.blob=i,c(i),t.clearRecordedData()})},this.pause=function(){d&&d.pause()},this.resume=function(){d&&d.resume()},this.clearRecordedData=function(){d&&(d.clearRecordedData(),d=null),a&&(a.releaseStreams(),a=null)},this.addStreams=function(c){if(!c)throw"First parameter is required.";c instanceof Array||(c=[c]),r.concat(c),!(!d||!a)&&(a.appendStreams(c),e.previewStream&&typeof e.previewStream=="function"&&e.previewStream(a.getMixedStream()))},this.resetVideoStreams=function(c){a&&(c&&!(c instanceof Array)&&(c=[c]),a.resetVideoStreams(c))},this.getMixer=function(){return a},this.name="MultiStreamRecorder",this.toString=function(){return this.name}}typeof g<"u"&&(g.MultiStreamRecorder=z);/**
 * RecordRTCPromisesHandler adds promises support in {@link RecordRTC}. Try a {@link https://github.com/muaz-khan/RecordRTC/blob/master/simple-demos/RecordRTCPromisesHandler.html|demo here}
 * @summary Promises for {@link RecordRTC}
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef RecordRTCPromisesHandler
 * @class
 * @example
 * var recorder = new RecordRTCPromisesHandler(mediaStream, options);
 * recorder.startRecording()
 *         .then(successCB)
 *         .catch(errorCB);
 * // Note: You can access all RecordRTC API using "recorder.recordRTC" e.g. 
 * recorder.recordRTC.onStateChanged = function(state) {};
 * recorder.recordRTC.setRecordingDuration(5000);
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - Single media-stream object, array of media-streams, html-canvas-element, etc.
 * @param {object} config - {type:"video", recorderType: MediaStreamRecorder, disableLogs: true, numberOfAudioChannels: 1, bufferSize: 0, sampleRate: 0, video: HTMLVideoElement, etc.}
 * @throws Will throw an error if "new" keyword is not used to initiate "RecordRTCPromisesHandler". Also throws error if first argument "MediaStream" is missing.
 * @requires {@link RecordRTC}
 */function ee(r,e){if(!this)throw'Use "new RecordRTCPromisesHandler()"';if(typeof r>"u")throw'First argument "MediaStream" is required.';var t=this;t.recordRTC=new g(r,e),this.startRecording=function(){return new Promise(function(a,d){try{t.recordRTC.startRecording(),a()}catch(s){d(s)}})},this.stopRecording=function(){return new Promise(function(a,d){try{t.recordRTC.stopRecording(function(s){if(t.blob=t.recordRTC.getBlob(),!t.blob||!t.blob.size){d("Empty blob.",t.blob);return}a(s)})}catch(s){d(s)}})},this.pauseRecording=function(){return new Promise(function(a,d){try{t.recordRTC.pauseRecording(),a()}catch(s){d(s)}})},this.resumeRecording=function(){return new Promise(function(a,d){try{t.recordRTC.resumeRecording(),a()}catch(s){d(s)}})},this.getDataURL=function(a){return new Promise(function(d,s){try{t.recordRTC.getDataURL(function(c){d(c)})}catch(c){s(c)}})},this.getBlob=function(){return new Promise(function(a,d){try{a(t.recordRTC.getBlob())}catch(s){d(s)}})},this.getInternalRecorder=function(){return new Promise(function(a,d){try{a(t.recordRTC.getInternalRecorder())}catch(s){d(s)}})},this.reset=function(){return new Promise(function(a,d){try{a(t.recordRTC.reset())}catch(s){d(s)}})},this.destroy=function(){return new Promise(function(a,d){try{a(t.recordRTC.destroy())}catch(s){d(s)}})},this.getState=function(){return new Promise(function(a,d){try{a(t.recordRTC.getState())}catch(s){d(s)}})},this.blob=null,this.version="5.6.2"}typeof g<"u"&&(g.RecordRTCPromisesHandler=ee);/**
 * WebAssemblyRecorder lets you create webm videos in JavaScript via WebAssembly. The library consumes raw RGBA32 buffers (4 bytes per pixel) and turns them into a webm video with the given framerate and quality. This makes it compatible out-of-the-box with ImageData from a CANVAS. With realtime mode you can also use webm-wasm for streaming webm videos.
 * @summary Video recording feature in Chrome, Firefox and maybe Edge.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef WebAssemblyRecorder
 * @class
 * @example
 * var recorder = new WebAssemblyRecorder(mediaStream);
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {webAssemblyPath:'webm-wasm.wasm',workerPath: 'webm-worker.js', frameRate: 30, width: 1920, height: 1080, bitrate: 1024, realtime: true}
 */function Q(r,e){(typeof ReadableStream>"u"||typeof WritableStream>"u")&&console.error("Following polyfill is strongly recommended: https://unpkg.com/@mattiasbuelens/web-streams-polyfill/dist/polyfill.min.js"),e=e||{},e.width=e.width||640,e.height=e.height||480,e.frameRate=e.frameRate||30,e.bitrate=e.bitrate||1200,e.realtime=e.realtime||!0;var t;function a(){return new ReadableStream({start:function(S){var l=document.createElement("canvas"),w=document.createElement("video"),v=!0;w.srcObject=r,w.muted=!0,w.height=e.height,w.width=e.width,w.volume=0,w.onplaying=function(){l.width=e.width,l.height=e.height;var y=l.getContext("2d"),h=1e3/e.frameRate,k=setInterval(function(){if(t&&(clearInterval(k),S.close()),v&&(v=!1,e.onVideoProcessStarted&&e.onVideoProcessStarted()),y.drawImage(w,0,0),S._controlledReadableStream.state!=="closed")try{S.enqueue(y.getImageData(0,0,e.width,e.height))}catch{}},h)},w.play()}})}var d;function s(S,l){if(!e.workerPath&&!l){t=!1,fetch("https://unpkg.com/webm-wasm@latest/dist/webm-worker.js").then(function(v){v.arrayBuffer().then(function(y){s(S,y)})});return}if(!e.workerPath&&l instanceof ArrayBuffer){var w=new Blob([l],{type:"text/javascript"});e.workerPath=B.createObjectURL(w)}e.workerPath||console.error("workerPath parameter is missing."),d=new Worker(e.workerPath),d.postMessage(e.webAssemblyPath||"https://unpkg.com/webm-wasm@latest/dist/webm-wasm.wasm"),d.addEventListener("message",function(v){v.data==="READY"?(d.postMessage({width:e.width,height:e.height,bitrate:e.bitrate||1200,timebaseDen:e.frameRate||30,realtime:e.realtime}),a().pipeTo(new WritableStream({write:function(y){if(t){console.error("Got image, but recorder is finished!");return}d.postMessage(y.data.buffer,[y.data.buffer])}}))):v.data&&(c||p.push(v.data))})}this.record=function(){p=[],c=!1,this.blob=null,s(r),typeof e.initCallback=="function"&&e.initCallback()};var c;this.pause=function(){c=!0},this.resume=function(){c=!1};function i(S){if(!d){S&&S();return}d.addEventListener("message",function(l){l.data===null&&(d.terminate(),d=null,S&&S())}),d.postMessage(null)}var p=[];this.stop=function(S){t=!0;var l=this;i(function(){l.blob=new Blob(p,{type:"video/webm"}),S(l.blob)})},this.name="WebAssemblyRecorder",this.toString=function(){return this.name},this.clearRecordedData=function(){p=[],c=!1,this.blob=null},this.blob=null}typeof g<"u"&&(g.WebAssemblyRecorder=Q)})(pt);var Gt=pt.exports;const Ht=at(Gt);var vt={exports:{}};(function(V,g){(function(H,q){V.exports=q(_)})(J,function(G){return function(H){var q={};function I(C){if(q[C])return q[C].exports;var D=q[C]={i:C,l:!1,exports:{}};return H[C].call(D.exports,D,D.exports,I),D.l=!0,D.exports}return I.m=H,I.c=q,I.d=function(C,D,U){I.o(C,D)||Object.defineProperty(C,D,{enumerable:!0,get:U})},I.r=function(C){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(C,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(C,"__esModule",{value:!0})},I.t=function(C,D){if(D&1&&(C=I(C)),D&8||D&4&&typeof C=="object"&&C&&C.__esModule)return C;var U=Object.create(null);if(I.r(U),Object.defineProperty(U,"default",{enumerable:!0,value:C}),D&2&&typeof C!="string")for(var K in C)I.d(U,K,(function(B){return C[B]}).bind(null,K));return U},I.n=function(C){var D=C&&C.__esModule?function(){return C.default}:function(){return C};return I.d(D,"a",D),D},I.o=function(C,D){return Object.prototype.hasOwnProperty.call(C,D)},I.p="",I(I.s="./src/react-webcam.tsx")}({"./src/react-webcam.tsx":function(H,q,I){I.r(q);var C=I("react"),D=function(){var A=function(E,f){return A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,T){b.__proto__=T}||function(b,T){for(var F in T)T.hasOwnProperty(F)&&(b[F]=T[F])},A(E,f)};return function(E,f){A(E,f);function b(){this.constructor=E}E.prototype=f===null?Object.create(f):(b.prototype=f.prototype,new b)}}(),U=function(){return U=Object.assign||function(A){for(var E,f=1,b=arguments.length;f<b;f++){E=arguments[f];for(var T in E)Object.prototype.hasOwnProperty.call(E,T)&&(A[T]=E[T])}return A},U.apply(this,arguments)},K=function(A,E){var f={};for(var b in A)Object.prototype.hasOwnProperty.call(A,b)&&E.indexOf(b)<0&&(f[b]=A[b]);if(A!=null&&typeof Object.getOwnPropertySymbols=="function")for(var T=0,b=Object.getOwnPropertySymbols(A);T<b.length;T++)E.indexOf(b[T])<0&&Object.prototype.propertyIsEnumerable.call(A,b[T])&&(f[b[T]]=A[b[T]]);return f};(function(){typeof window>"u"||(navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(E){var f=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return f?new Promise(function(b,T){f.call(navigator,E,b,T)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}))})();function B(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}var ae=function(A){D(E,A);function E(f){var b=A.call(this,f)||this;return b.canvas=null,b.ctx=null,b.requestUserMediaId=0,b.unmounted=!1,b.state={hasUserMedia:!1},b}return E.prototype.componentDidMount=function(){var f=this,b=f.state,T=f.props;if(this.unmounted=!1,!B()){T.onUserMediaError("getUserMedia not supported");return}b.hasUserMedia||this.requestUserMedia(),T.children&&typeof T.children!="function"&&console.warn("children must be a function")},E.prototype.componentDidUpdate=function(f){var b=this.props;if(!B()){b.onUserMediaError("getUserMedia not supported");return}var T=JSON.stringify(f.audioConstraints)!==JSON.stringify(b.audioConstraints),F=JSON.stringify(f.videoConstraints)!==JSON.stringify(b.videoConstraints),X=f.minScreenshotWidth!==b.minScreenshotWidth,$=f.minScreenshotHeight!==b.minScreenshotHeight;(F||X||$)&&(this.canvas=null,this.ctx=null),(T||F)&&(this.stopAndCleanup(),this.requestUserMedia())},E.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},E.stopMediaStream=function(f){f&&(f.getVideoTracks&&f.getAudioTracks?(f.getVideoTracks().map(function(b){f.removeTrack(b),b.stop()}),f.getAudioTracks().map(function(b){f.removeTrack(b),b.stop()})):f.stop())},E.prototype.stopAndCleanup=function(){var f=this.state;f.hasUserMedia&&(E.stopMediaStream(this.stream),f.src&&window.URL.revokeObjectURL(f.src))},E.prototype.getScreenshot=function(f){var b=this,T=b.state,F=b.props;if(!T.hasUserMedia)return null;var X=this.getCanvas(f);return X&&X.toDataURL(F.screenshotFormat,F.screenshotQuality)},E.prototype.getCanvas=function(f){var b=this,T=b.state,F=b.props;if(!this.video||!T.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var X=this.video.videoWidth,$=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var x=X/$;X=F.minScreenshotWidth||this.video.clientWidth,$=X/x,F.minScreenshotHeight&&$<F.minScreenshotHeight&&($=F.minScreenshotHeight,X=$*x)}this.canvas=document.createElement("canvas"),this.canvas.width=(f==null?void 0:f.width)||X,this.canvas.height=(f==null?void 0:f.height)||$,this.ctx=this.canvas.getContext("2d")}var Z=this,te=Z.ctx,N=Z.canvas;return te&&N&&(N.width=(f==null?void 0:f.width)||N.width,N.height=(f==null?void 0:f.height)||N.height,F.mirrored&&(te.translate(N.width,0),te.scale(-1,1)),te.imageSmoothingEnabled=F.imageSmoothing,te.drawImage(this.video,0,0,(f==null?void 0:f.width)||N.width,(f==null?void 0:f.height)||N.height),F.mirrored&&(te.scale(-1,1),te.translate(-N.width,0))),N},E.prototype.requestUserMedia=function(){var f=this,b=this.props,T=function($,x){var Z={video:typeof x<"u"?x:!0};b.audio&&(Z.audio=typeof $<"u"?$:!0),f.requestUserMediaId++;var te=f.requestUserMediaId;navigator.mediaDevices.getUserMedia(Z).then(function(N){f.unmounted||te!==f.requestUserMediaId?E.stopMediaStream(N):f.handleUserMedia(null,N)}).catch(function(N){f.handleUserMedia(N)})};if("mediaDevices"in navigator)T(b.audioConstraints,b.videoConstraints);else{var F=function($){return{optional:[{sourceId:$}]}},X=function($){var x=$.deviceId;return typeof x=="string"?x:Array.isArray(x)&&x.length>0?x[0]:typeof x=="object"&&x.ideal?x.ideal:null};MediaStreamTrack.getSources(function($){var x=null,Z=null;$.forEach(function(re){re.kind==="audio"?x=re.id:re.kind==="video"&&(Z=re.id)});var te=X(b.audioConstraints);te&&(x=te);var N=X(b.videoConstraints);N&&(Z=N),T(F(x),F(Z))})}},E.prototype.handleUserMedia=function(f,b){var T=this.props;if(f||!b){this.setState({hasUserMedia:!1}),T.onUserMediaError(f);return}this.stream=b;try{this.video&&(this.video.srcObject=b),this.setState({hasUserMedia:!0})}catch{this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(b)})}T.onUserMedia(b)},E.prototype.render=function(){var f=this,b=this,T=b.state,F=b.props,X=F.audio;F.forceScreenshotSourceSize;var $=F.disablePictureInPicture;F.onUserMedia,F.onUserMediaError,F.screenshotFormat,F.screenshotQuality,F.minScreenshotWidth,F.minScreenshotHeight,F.audioConstraints,F.videoConstraints,F.imageSmoothing;var x=F.mirrored,Z=F.style,te=Z===void 0?{}:Z,N=F.children,re=K(F,["audio","forceScreenshotSourceSize","disablePictureInPicture","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style","children"]),se=x?U(U({},te),{transform:(te.transform||"")+" scaleX(-1)"}):te,ce={getScreenshot:this.getScreenshot.bind(this)};return C.createElement(C.Fragment,null,C.createElement("video",U({autoPlay:!0,disablePictureInPicture:$,src:T.src,muted:!X,playsInline:!0,ref:function(Re){f.video=Re},style:se},re)),N&&N(ce))},E.defaultProps={audio:!1,disablePictureInPicture:!1,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},E}(C.Component);q.default=ae},react:function(H,q){H.exports=G}}).default})})(vt);var $t=vt.exports;const nt=at($t),mt=({selectedVideoDevices:V,videoDevices:g,webcamRef:G})=>{const H=g.find(q=>q.label===V[0]);switch(V.length){case 0:return m.jsx("div",{style:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center",height:350,border:"2px dashed black",borderRadius:5},children:m.jsx("p",{style:{textAlign:"center",fontSize:24},children:m.jsx(Te,{id:"videoDeviceSelect"})})});case 1:return m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"20px"},children:[H&&m.jsxs(ye,{children:[m.jsx(Fe,{children:H.label}),m.jsx(nt,{videoConstraints:{deviceId:H.deviceId},style:{borderRadius:5,width:"100%",height:"auto"},screenshotFormat:"image/jpeg",ref:G})]}),m.jsx("div",{style:{width:"50%",height:350,border:"2px dashed black",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:5},children:m.jsx("p",{style:{textAlign:"center",fontSize:24},children:m.jsx(Te,{id:"videoDeviceSelect"})})})]});default:return m.jsx("div",{style:{overflowX:"auto",whiteSpace:"nowrap",display:"flex",gap:"20px",borderRadius:5},children:V.map(q=>{const I=g.find(C=>C.label===q);return I?m.jsxs(ye,{children:[m.jsx(Fe,{children:I.label}),m.jsx(nt,{videoConstraints:{deviceId:I.deviceId},style:{width:"100%",height:350,borderRadius:5},screenshotFormat:"image/jpeg"})]},I.deviceId):null})})}};mt.propTypes={selectedVideoDevices:Y.array.isRequired,videoDevices:Y.array.isRequired,webcamRef:Y.object.isRequired};function Kt(){const[V,g]=_.useState(null),G=_.useRef(null),H=_.useRef({fftSize:2048}),q=_.useRef(H.current.fftSize/2),I=_.useRef(new Uint8Array(q.current));_.useEffect(()=>{const U=setInterval(async()=>{try{const B=(await Be.get("/audio_stream")).data.audio_channel1;I.current.set(B.map(ae=>Math.min(255,ae*255))),g([...I.current])}catch(K){console.error("Error fetching audio stream:",K)}},50);return()=>clearInterval(U)},[]);const C=()=>{const D=G.current;if(!D)return;const U=D.getContext("2d");U.clearRect(0,0,D.width,D.height);const K=U.createLinearGradient(0,0,D.width,0);K.addColorStop(0,"rgba(66, 135, 245, 0)"),K.addColorStop(.2,"#fb8c00"),K.addColorStop(.5,"#568166"),K.addColorStop(.8,"#fb8c00"),K.addColorStop(1,"rgba(66, 135, 245, 0)"),U.fillStyle="rgba(0, 0, 0, 0)",U.fillRect(0,0,D.width,D.height),U.lineWidth=2,U.strokeStyle=K,U.beginPath();const B=D.width*1/q.current;let ae=0;for(let A=0;A<q.current;A++){const f=I.current[A]/128*D.height/2;A===0?U.moveTo(ae,f):U.lineTo(ae,f),ae+=B}U.lineTo(D.width,D.height/2),U.stroke(),U.font="12px Arial",U.fillStyle="rgba(255, 255, 255, 0.7)",U.fillText("Raspberry Pi Mic Input",10,D.height-10),requestAnimationFrame(C)};return _.useEffect(()=>(requestAnimationFrame(C),()=>cancelAnimationFrame(C)),[]),m.jsxs(m.Fragment,{children:[m.jsxs("div",{children:[" ",V?"":"Loading..."]}),m.jsx("canvas",{ref:G,width:"600",height:"90"})]})}gt.propTypes={username:Y.string.isRequired,material:Y.string,speed:Y.string,isCamera:Y.bool.isRequired,measurementCounter:Y.number.isRequired,setMeasurementCounter:Y.func.isRequired,isRecordingStarted:Y.func.isRequired,selectedVideoDevices:Y.array.isRequired,videoDevices:Y.array.isRequired,audioFiles:Y.array.isRequired,setAudioFiles:Y.func.isRequired,setRecordingStatus:Y.string.isRequired,localDir:Y.string.isRequired};function gt({username:V,material:g,speed:G,measurementCounter:H,setMeasurementCounter:q,selectedVideoDevices:I,videoDevices:C,setAudioFiles:D,setRecordingStatus:U,localDir:K}){const B=At(),ae=_.useRef(null),A=_.useRef([]),[E,f]=_.useState([]),[b,T]=_.useState([]),[F,X]=_.useState([]),[$,x]=_.useState(!1),[Z,te]=_.useState(!1),[N,re]=_.useState(!1),[se,ce]=_.useState(""),Re=_.useCallback((z,{data:ee},Q)=>{ee.size>0&&T(r=>[...r,{recorder:z,data:ee,cameraIndex:Q}])},[T]),Ae=async()=>{try{const ee=(await Promise.all(F.map(async Q=>{const r=C[Q];if(!r)return console.log("Video device not found. Camera Index: "+Q),null;const e=await navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:r.deviceId}},audio:!0}),t=new Ht(e,{mimeType:"video/webm"});return t.startRecording(),t.ondataavailable=a=>Re(t,{data:a},Q),A.current.push({recorder:t,stream:e}),{recorder:t,stream:e}}))).filter(Boolean);A.current=ee}catch(z){console.error("Error starting multiple recordings:",z),ce(`Error starting recordings: ${z.message}`)}},De=()=>{A.current&&A.current.length>0?(A.current.forEach(({recorder:z,stream:ee})=>{z.stopRecording(()=>{const Q=z.getBlob();Re(z,{data:Q})}),ee.getTracks().forEach(Q=>Q.stop())}),A.current=[]):console.warn("No recordings to stop or recorders were not initialized.")};_.useEffect(()=>{Z?Ae():De()},[Z]);const le=async()=>{if(b&&b.length>0){re(!1);let z=0;const ee=b.map(async({data:Q,cameraIndex:r})=>{const e=new Blob([Q],{type:"video/webm"}),t=new Date,a=t.getFullYear(),d=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0"),c=String(t.getHours()).padStart(2,"0"),i=String(t.getMinutes()).padStart(2,"0"),p=String(t.getSeconds()).padStart(2,"0"),S=`${a}-${d}-${s}_${c}.${i}.${p}`,l=`${V}_${g}_${G}_camera${r||z}_${S}.webm`;r===void 0&&z++;const w=new FileReader;return new Promise((v,y)=>{w.onloadend=async()=>{const h=w.result.split(",")[1];try{const k=await Be.post("/save_video",{filename:l,local_dir:K,data:h});v(k.data)}catch(k){console.error("Error uploading video:",k),y(k)}},w.readAsDataURL(e)})});try{const Q=await Promise.all(ee);console.log("Uploaded videos:",Q),ce(B.formatMessage({id:"recordingUploaded"})+Q[0].filename)}catch(Q){console.error("Error during upload:",Q)}}else console.log("Error with recorded chunks")},ke=_.useCallback(async()=>{x(!0);try{if(Z){const z=await Be.get("/stop"),ee=z.data.map(Q=>Q.filename);ce(B.formatMessage({id:"recordedSuccesfully"})+ee.join(", ")),q(H+1),re(!0),D(z.data),U("stop")}else ce(B.formatMessage({id:"connectingToRaspberry"})),await Be.post("/start",{username:V,material:g,speed:G}),ce(B.formatMessage({id:"recordingStarted"})),N&&await le(),re(!1),X(I.map(z=>C.findIndex(ee=>ee.label===z)).filter(z=>z!==-1)),T([]),U("start");te(z=>!z)}catch(z){ce(B.formatMessage({id:"recordingConnectFailed"})+z)}finally{x(!1)}},[Z,H,V,g,G,q,D]),je=_.useCallback(async()=>{x(!0);try{const z=await Be.get("/delete_last");ce(B.formatMessage({id:"recordingDeleteSuccess"})+z.data),q(H-1>=0?H-1:0),re(!1),T([]),U("delete")}catch(z){ce(B.formatMessage({id:"recordingDeleteFailed"})+z)}finally{x(!1)}},[H,q]);return _.useEffect(()=>{const z=ee=>{$||G==null||g==null||G==null||g==null||(ee.ctrlKey&&ee.shiftKey&&ee.key==="R"?ke():ee.ctrlKey&&ee.shiftKey&&ee.key==="D"&&je())};return window.addEventListener("keydown",z),()=>{window.removeEventListener("keydown",z)}},[ke,je]),m.jsxs(ye,{spacing:2,children:[m.jsx(Kt,{}),m.jsxs(ye,{direction:"row",spacing:2,children:[m.jsx(_e,{onClick:ke,variant:"contained",startIcon:Z?m.jsx(ht,{sx:{color:"red"}}):null,disabled:$||G==null||g==null||G==null||g==null,children:Z?B.formatMessage({id:"stopRecording"}):B.formatMessage({id:"startRecording"})}),N&&m.jsx(_e,{onClick:je,variant:"contained",disabled:$||G==null||g==null||G==null||g==null,startIcon:m.jsx(Ut,{}),children:B.formatMessage({id:"deleteRecording"})}),N&&b&&b.length>0&&m.jsx(_e,{onClick:le,variant:"contained",ref:E,disabled:$||G==null||g==null||G==null||g==null,startIcon:m.jsx(lt,{}),children:B.formatMessage({id:"downloadRecording"})})]}),m.jsx(Fe,{children:se}),m.jsx(mt,{selectedVideoDevices:I,videoDevices:C,webcamRef:ae})]})}function bt({selectedVideoDevices:V,setSelectedVideoDevices:g,videoDevices:G,setVideoDevices:H}){_.useEffect(()=>{(async()=>{try{const D=(await navigator.mediaDevices.enumerateDevices()).filter(U=>U.kind==="videoinput");H(D)}catch(C){console.error("Error fetching media devices:",C)}})()},[]);const q=I=>{g(I.target.value)};return m.jsx("div",{children:m.jsx(ye,{sx:ot,direction:"row",children:m.jsxs(He,{sx:$e,children:[m.jsx(Ye,{id:"video-devices-label",children:m.jsx(Te,{id:"videoDevices"})}),m.jsx(Ke,{sx:Je,labelId:"video-devices-label",id:"video-devices",multiple:!0,value:V,onChange:q,renderValue:I=>I.join(", "),label:m.jsx(Te,{id:"videoDevices"}),children:G.map(I=>m.jsxs(Qe,{value:I.label,children:[m.jsx(st,{checked:V.includes(I.label)}),m.jsx(dt,{primary:I.label})]},I.label))})]})})})}bt.propTypes={selectedVideoDevices:Y.array.isRequired,setSelectedVideoDevices:Y.func.isRequired,videoDevices:Y.array.isRequired,setVideoDevices:Y.func.isRequired};const Jt=({config:V})=>{const[g,G]=_.useState([]),[H,q]=_.useState([]),[I,C]=_.useState(null),[D,U]=_.useState(null),[K,B]=_.useState(0),[ae,A]=_.useState([]),[E,f]=_.useState("init"),b=sessionStorage.getItem("commentAcquisiton")||"",[T,F]=_.useState(b),X=x=>{C(x.target.value)},$=x=>{U(x.target.value)};return _.useEffect(()=>{sessionStorage.setItem("commentAcquisiton",T)},[T]),console.log("Acq",V),m.jsx("div",{children:m.jsxs(ye,{sx:{width:"100%",gap:10},direction:"row",children:[m.jsxs(ye,{sx:{gap:3,width:"35%"},children:[m.jsxs(Fe,{id:"username",labelId:"usernameLabel",variant:"h6",children:[m.jsx(Te,{id:"username"}),": ",V.username]}),m.jsxs(ye,{sx:{width:"100%",gap:2},children:[m.jsx(bt,{selectedVideoDevices:g,setSelectedVideoDevices:G,videoDevices:H,setVideoDevices:q}),m.jsxs(ye,{sx:{width:"100%",gap:2},children:[m.jsxs(He,{sx:$e,children:[m.jsx(Ye,{children:m.jsx(Te,{id:"Material"})}),m.jsx(Ke,{sx:Je,labelId:"materialSelect",label:"Material",id:"material",value:I,onChange:X,children:V.chosenMaterials.filter(x=>x!==0).map(x=>m.jsx(Qe,{value:x,children:x},x))})]}),m.jsxs(He,{sx:$e,children:[m.jsx(Ye,{children:m.jsx(Te,{id:"speed"})}),m.jsx(Ke,{sx:Je,labelId:"materialSelect",label:"Speed",id:"speed",value:D,onChange:$,children:V.chosenSpeeds.filter(x=>x!==0).map(x=>m.jsx(Qe,{value:x,children:x},x))})]})]})]}),m.jsx(ye,{sx:{width:"100%"},children:m.jsx(ft,{config:V})}),m.jsxs(Fe,{children:[m.jsx(Te,{id:"performedMeasurements"}),": ",K]})]}),m.jsx(ye,{sx:ot,mt:1,spacing:2,children:m.jsx(gt,{username:V.username,material:I,speed:D,measurementCounter:K,setMeasurementCounter:B,selectedVideoDevices:g,videoDevices:H,audioFiles:ae,setAudioFiles:A,setRecordingStatus:f,localDir:V.local_dir})})]})})};Jt.propTypes={config:Y.object.isRequired};export{Jt as default};
